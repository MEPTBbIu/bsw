var name = "#floatMenu";
var menuYloc = null;
var rightColoumn = "#main-center-X";
var wrapHeight = "#container-table-form-toolbox";

function togglePanel(action) {

	if (action == 'hide') {
		$('#main-center-X').slideUp("meduim");
	} else {
		$('#main-center-X').slideDown("fast");
	}
}

$(document).ready(function() {

	$('.cut_img_close').live('click', function() {

		if(confirm('Are you sure you want to delete this image. This action CANNOT be undone.'))
		{
			var img = $(this).parents('.cust-image-box').find('a').attr('rel');

			$object	= $(this).parents('.cust-image-box');

			var enc_img = encodeURIComponent(img);

			var form_id = $('#form_id').val();
			var cust_id	= $('#cust_id').val();

			var url = base_path+'form/delete_accnt_images';

			$.post(
				url,
				{
					cust_id	: cust_id,
					form_id	: form_id,
					enc_img : enc_img
				}, 
				function(data) {

					if(data == 'success') {

						$object.fadeOut("fast",function() {
							$(this).remove();
						});

					}else {
						alert('Something went wrong, please contact at support@form2pay.com!');
						return false;
					}
				}
			);
			return false;
		}else {
			return false;
		}
	});

	onerror = function(e) {
		alert(e); // showing an error like Objectx is null or not an Object in IE
	}

	shortcut.add("Down",function() {

		var current = $('.super-selected-li');
		current.next().after(current);

		$('#sortable input.ordering').each(function(i) {
			i++;
			$(this).val(i);
		});

		$('.properties-table').each(function() {
			$(this).hide();
		});

	});

	shortcut.add("Up",function() {

		var current = $('.super-selected-li');
		current.prev().before(current);

		$('#sortable input.ordering').each(function(i) {
			i++;
			$(this).val(i);
		});

		$('.properties-table').each(function() {
			$(this).hide();
		});
	});

	shortcut.add("Ctrl+Shift+A",function() {

		var destination = $('.addFieldBtnSml').offset().top;
		$("html:not(:animated),body:not(:animated)").animate({ scrollTop: destination-20}, 500 );
		clickAction();
	});

	shortcut.add("Ctrl+S",function() {

		if($('#save').val() == 'form_builder') {
			$('#tool-save').click();
		}else if($('#save').val() == 'styling') {
			$('#tool-save-styling').click();
		}else {
			$('#tool-settings').click();
		}

	});

	shortcut.add("Ctrl+P",function(){

		if($('#preview').val() == 'styling') {
			$('#tool-styling-preview').click();
		}else {
			$('#tool-preview').click();
		}

	});
	/*---------All the Keyboard Shortcuts----------------*/

	$('#hide_show_advance_settings').live('click', function() {

		$('.advance_settings').toggle();
	});


	$('.number-only').live('keydown', function(e) {
		var key = e.charCode || e.keyCode || 0;
		// allow backspace, tab, delete, arrows, numbers and keypad numbers ONLY
		return ( key == 8 || key == 9 || key == 46 || (key >= 37 && key <= 40) || (key >= 48 && key <= 57) || (key >= 96 && key <= 105) || key == 190 || key == 110);
	});

	$('input[name=image_source]').focus(function() {

		$(this).parents('td').find('button').click();
	
	});

	$('.back-to-general-information').live('click', function()
	{
		$('#tool-save').click();

		var id = $(this).attr('id');

		if(id == 'back_to_general_information') {

			//$('#general_information').click();
			window.location.hash = 'show-general_information';

		}else {

			$('#form-overlay').click();
		}
	});

	$('.save-style').live('click', function() {

		var id = $(this).attr('id');

		$('.main-loader').slideDown("slow");

		var form_id								=	$('#form_id').val();

		var body_default						=	($('#body_default').is(':checked')) ? '1' : '0';
		if(body_default == 1) {
			var body_background_color			=	'#1E1E1E';
			var body_background_image			=	'';
			var body_background_image_url		=	'';
		}else {
			var body_background_color			=	$('#body-background-color-input').val();
			var body_background_image			=	$('#body-background-image-input').val();
			var body_background_image_url		=	$('#body-background-image-url-input').val();
		}

		var form_default						=	($('#form_default').is(':checked')) ? '1' : '0';
		if(form_default == 1) {
			var form_width						=	'630';
			var form_background_color			=	'#FFFFFF';
			var form_background_image			=	'';
			var form_background_image_url		=	'';
			var form_show_border				=	($('#form-show-border').is(':checked')) ? '1' : '0';
			var form_border_style				=	'solid';
			var form_border_thickness			=	'1px';
			var form_border_color				=	'#535353';
			var form_shadow						=	($('#form_shadow').is(':checked')) ? '1' : '0';
			var form_field_spacing				=	'8';
		}else {
			var form_width						=	$('#form_width').val();
			var form_background_color			=	$('#form-background-color-input').val();
			var form_background_image			=	$('#form-background-image-input').val();
			var form_background_image_url		=	$('#form-background-image-url-input').val();
			var form_show_border				=	($('#form-show-border').is(':checked')) ? '1' : '0';
			var form_border_style				=	$('#form-border-style-input').val();
			var form_border_thickness			=	$('#form-border-thickness-input').val();
			var form_border_color				=	$('#form-border-color-input').val();
			var form_shadow						=	($('#form_shadow').is(':checked')) ? '1' : '0';
			var form_field_spacing				=	$('#form-field-spacing-input').val();
		}

		var header_default						=	($('#header_default').is(':checked')) ? '1' : '0';
		if(header_default == 1) {
			var show_header						=	($('#show_header').is(':checked')) ? '1' : '0';
			var header_background				=	'#2E8ABF';
			var header_font_family				=	'Arial,Helvetica,sans-serif';
			var header_font_style				=	'bold';
			var header_font_size				=	'18';
			var header_font_color				=	'#FFFFFF';
		}else {
			var show_header						=	($('#show_header').is(':checked')) ? '1' : '0';
			var header_background				=	$('#header-background-input').val();
			var header_font_family				=	$('#header-font-family-input').val();
			var header_font_style				=	$('#header-font-style-input').val();
			var header_font_size				=	$('#header-font-size-input').val();
			var header_font_color				=	$('#header-font-color-input').val();
		}

		var desc_default						=	($('#desc_default').is(':checked')) ? '1' : '0';
		if(desc_default == 1) {
			var desc_font_family				=	'Arial,Helvetica,sans-serif';
			var desc_font_style					=	'normal';
			var desc_font_size					=	'18';
			var desc_font_color					=	'#000000';
			var sub_desc_font_family			=	'Arial,Helvetica,sans-serif';
			var sub_desc_font_style				=	'normal';
			var sub_desc_font_size				=	'12';
			var sub_desc_font_color				=	'#000000';
		}else {
			var desc_font_family				=	$('#desc-font-family-input').val();
			var desc_font_style					=	$('#desc-font-style-input').val();
			var desc_font_size					=	$('#desc-font-size-input').val();
			var desc_font_color					=	$('#desc-font-color-input').val();
			var sub_desc_font_family			=	$('#sub-desc-font-family-input').val();
			var sub_desc_font_style				=	$('#sub-desc-font-style-input').val();
			var sub_desc_font_size				=	$('#sub-desc-font-size-input').val();
			var sub_desc_font_color				=	$('#sub-desc-font-color-input').val();
		}

		var fields_default						=	($('#fields_default').is(':checked')) ? '1' : '0';
		if(fields_default == 1) {
			var fields_show_border				=	'1';
			var fields_border_thickness			=	'1px';
			var fields_border_style				=	'solid';
			var fields_border_color				=	'#7F9DB9';
			var fields_padding					=	'2px';
			var input_font_family				=	'Arial,Helvetica,sans-serif';
			var input_font_style				=	'normal';
			var input_font_size					=	'12';
			var input_font_color				=	'#000000';
		}else {
			var fields_show_border				=	($('#fields-show-border').is(':checked')) ? '1' : '0';
			if(fields_show_border == 0) {
				var fields_border_thickness		=	'1px';
				var fields_border_style			=	'solid';
				var fields_border_color			=	'#7F9DB9';
			}else {
				var fields_border_thickness		=	$('#fields-border-thickness-input').val();
				var fields_border_style			=	$('#fields-border-style-input').val();
				var fields_border_color			=	$('#fields-border-color-input').val();
			}
			var fields_padding					=	$('#fields-padding-input').val();
			var input_font_family				=	$('#input-font-family-input').val();
			var input_font_style				=	$('#input-font-style-input').val();
			var input_font_size					=	$('#input-font-size-input').val();
			var input_font_color				=	$('#input-font-color-input').val();
		}

		var labels_default						=	($('#labels_default').is(':checked')) ? '1' : '0';
		if(labels_default == 1) {
			var label_font_family				=	'Arial,Helvetica,sans-serif';
			var label_font_style				=	'bold';
			var label_font_size					=	'12';
			var label_font_color				=	'#000000';
			var ch_label_font_family			=	'Arial,Helvetica,sans-serif';
			var ch_label_font_style				=	'normal';
			var ch_label_font_size				=	'12';
			var ch_label_font_color				=	'#000000';
			var sub_label_font_family			=	'Arial,Helvetica,sans-serif';
			var sub_label_font_style			=	'italic';
			var sub_label_font_size				=	'10';
			var sub_label_font_color			=	'#000000';
			var label_width						=	'150';
			var label_align						=	'left';
		}else {
			var label_font_family				=	$('#label-font-family-input').val();
			var label_font_style				=	$('#label-font-style-input').val();
			var label_font_size					=	$('#label-font-size-input').val();
			var label_font_color				=	$('#label-font-color-input').val();
			var ch_label_font_family			=	$('#ch-label-font-family-input').val();
			var ch_label_font_style				=	$('#ch-label-font-style-input').val();
			var ch_label_font_size				=	$('#ch-label-font-size-input').val();
			var ch_label_font_color				=	$('#ch-label-font-color-input').val();
			var sub_label_font_family			=	$('#sub-label-font-family-input').val();
			var sub_label_font_style			=	$('#sub-label-font-style-input').val();
			var sub_label_font_size				=	$('#sub-label-font-size-input').val();
			var sub_label_font_color			=	$('#sub-label-font-color-input').val();
			var label_width						=	$('#label-width-input').val();
			var label_align						=	$('#label-align-input').val();
		}

		var warnings_default					=	($('#warnings_default').is(':checked')) ? '1' : '0';
		if(warnings_default == 1) {
			var warnings_font_family			=	'Arial,Helvetica,sans-serif';
			var warnings_font_style				=	'bold';
			var warnings_font_size				=	'12';
			var warnings_font_color				=	'#D62828';
			var warnings_background_color		=	'#FFDBDB';
			var warnings_show_border			=	($('#warnings-show-border').is(':checked')) ? '1' : '0';
			var warnings_border_style			=	'solid';
			var warnings_border_thickness		=	'1px';
			var warnings_border_color			=	'#FFB7B7';
			var warnings_shadow					=	($('#warnings_shadow').is(':checked')) ? '1' : '0';
		}else {
			var warnings_font_family			=	$('#warnings-font-family-input').val();
			var warnings_font_style				=	$('#warnings-font-style-input').val();
			var warnings_font_size				=	$('#warnings-font-size-input').val();
			var warnings_font_color				=	$('#warnings-font-color-input').val();
			var warnings_background_color		=	$('#warnings-background-color-input').val();
			var warnings_show_border			=	($('#warnings-show-border').is(':checked')) ? '1' : '0';
			var warnings_border_style			=	$('#warnings-border-style-input').val();
			var warnings_border_thickness		=	$('#warnings-border-thickness-input').val();
			var warnings_border_color			=	$('#warnings-border-color-input').val();
			var warnings_shadow					=	($('#warnings_shadow').is(':checked')) ? '1' : '0';
		}

		var tool_tip_default					=	($('#tool_tip_default').is(':checked')) ? '1' : '0';
		if(tool_tip_default == 1) {
			var tool_tip_font_family			=	'Arial,Helvetica,sans-serif';
			var tool_tip_font_style				=	'normal';
			var tool_tip_font_size				=	'11';
			var tool_tip_font_color				=	'#ffffff';
			var tool_tip_background_color		=	'#444444';
			var tool_tip_show_border			=	($('#tool-tip-show-border').is(':checked')) ? '1' : '0';
			var tool_tip_border_style			=	'solid';
			var tool_tip_border_thickness		=	'1px';
			var tool_tip_border_color			=	'#666666';
			var tool_tip_shadow					=	($('#tool_tip_shadow').is(':checked')) ? '1' : '0';
			var tool_tip_below_font_family		=	'Arial,Helvetica,sans-serif';
			var tool_tip_below_font_style		=	'normal';
			var tool_tip_below_font_size		=	'11';
			var tool_tip_below_font_color		=	'#999999';
			var tool_tip_below_shadow			=	($('#tool_tip_below_shadow').is(':checked')) ? '1' : '0';
		}else {
			var tool_tip_font_family			=	$('#tool-tip-font-family-input').val();
			var tool_tip_font_style				=	$('#tool-tip-font-style-input').val();
			var tool_tip_font_size				=	$('#tool-tip-font-size-input').val();
			var tool_tip_font_color				=	$('#tool-tip-font-color-input').val();
			var tool_tip_background_color		=	$('#tool-tip-background-color-input').val();
			var tool_tip_show_border			=	($('#tool-tip-show-border').is(':checked')) ? '1' : '0';
			var tool_tip_border_style			=	$('#tool-tip-border-style-input').val();
			var tool_tip_border_thickness		=	$('#tool-tip-border-thickness-input').val();
			var tool_tip_border_color			=	$('#tool-tip-border-color-input').val();
			var tool_tip_shadow					=	($('#tool_tip_shadow').is(':checked')) ? '1' : '0';
			var tool_tip_below_font_family		=	$('#tool-tip-below-font-family-input').val();
			var tool_tip_below_font_style		=	$('#tool-tip-below-font-style-input').val();
			var tool_tip_below_font_size		=	$('#tool-tip-below-font-size-input').val();
			var tool_tip_below_font_color		=	$('#tool-tip-below-font-color-input').val();
			var tool_tip_below_shadow			=	($('#tool_tip_below_shadow').is(':checked')) ? '1' : '0';
		}

		var footer_default						=	($('#footer_default').is(':checked')) ? '1' : '0';
		if(footer_default == 1) {
			var show_footer						=	($('#show_footer').is(':checked')) ? '1' : '0';
			var footer_background				=	'#2E8ABF';
			var footer_font_family				=	'Arial,Helvetica,sans-serif';
			var footer_font_style				=	'normal';
			var footer_font_size				=	'12';
			var footer_font_color				=	'#FFFFFF';
		}else {
			var show_footer						=	($('#show_footer').is(':checked')) ? '1' : '0';
			var footer_background				=	$('#footer-background-input').val();
			var footer_font_family				=	$('#footer-font-family-input').val();
			var footer_font_style				=	$('#footer-font-style-input').val();
			var footer_font_size				=	$('#footer-font-size-input').val();
			var footer_font_color				=	$('#footer-font-color-input').val();
		}

		var button_default						=	($('#button_default').is(':checked')) ? '1' : '0';
		if(button_default == 1) {
			var submit_button_font_family		=	'';
			var submit_button_font_style		=	'';
			var submit_button_font_size			=	'13px';
			var submit_button_font_color		=	'#2D2D2D';
			var submit_button_background_color	=	'';
			var submit_button_show_border		=	'0';
			var submit_button_border_style		=	'';
			var submit_button_border_thickness	=	'';
			var submit_button_border_color		=	'';
			var submit_button_border_radius		=	'';
			var submit_button_shadow			=	'0';
			var submit_button_align				=	'none';
			var predefined_submit_button_show	=	'0';
			var predefined_submit_button_class	=	'';

		}else {

			var submit_button_font_family		=	$('#submit-button-font-family-input').val();
			var submit_button_font_style		=	$('#submit-button-font-style-input').val();
			var submit_button_font_size			=	$('#submit-button-font-size-input').val();
			var submit_button_font_color		=	$('#submit-button-font-color-input').val();
			var submit_button_background_color	=	$('#submit-button-background-color-input').val();
			var submit_button_show_border		=	($('#submit-button-show-border').is(':checked')) ? '1' : '0';
			var submit_button_border_style		=	$('#submit-button-border-style-input').val();
			var submit_button_border_thickness	=	$('#submit-button-border-thickness-input').val();
			var submit_button_border_color		=	$('#submit-button-border-color-input').val();
			var submit_button_border_radius		=	$('#submit-button-border-radius-input').val();
			var submit_button_shadow			=	($('#submit_button_shadow').is(':checked')) ? '1' : '0';
			var submit_button_align				=	$('#submit-button-align-input').val();
			var predefined_submit_button_show	=	($('#predefined-submit-button-show').is(':checked')) ? '1' : '0';
			var predefined_submit_button_class	=	$('#predefined-submit-button-class-input').val();
		}

//		var custom_css = $('#custom_css').val();

		var url = base_path+'form/save_styling';

		$.post(url, {form_id:form_id, body_background_color: body_background_color, body_background_image: body_background_image, body_background_image_url: body_background_image_url, form_width: form_width, form_background_color:form_background_color, form_background_image: form_background_image, form_background_image_url: form_background_image_url, form_show_border:form_show_border, form_border_style:form_border_style, form_border_thickness: form_border_thickness, form_border_color:form_border_color, form_shadow:form_shadow, form_field_spacing:form_field_spacing, show_header:show_header, header_background:header_background, header_font_family:header_font_family, header_font_style:header_font_style, header_font_size: header_font_size, header_font_color:header_font_color, desc_font_family:desc_font_family, desc_font_style:desc_font_style, desc_font_size:desc_font_size, desc_font_color:desc_font_color, sub_desc_font_family:sub_desc_font_family, sub_desc_font_style:sub_desc_font_style, sub_desc_font_size:sub_desc_font_size, sub_desc_font_color:sub_desc_font_color, fields_show_border:fields_show_border, fields_border_style:fields_border_style, fields_border_thickness:fields_border_thickness, fields_border_color:fields_border_color, fields_padding:fields_padding, input_font_family:input_font_family, input_font_style:input_font_style, input_font_size:input_font_size, input_font_color:input_font_color, label_font_family:label_font_family, label_font_style:label_font_style, label_font_size:label_font_size, label_font_color:label_font_color, ch_label_font_family:ch_label_font_family, ch_label_font_style:ch_label_font_style, ch_label_font_size:ch_label_font_size, ch_label_font_color:ch_label_font_color, sub_label_font_family:sub_label_font_family, sub_label_font_style:sub_label_font_style, sub_label_font_size:sub_label_font_size, sub_label_font_color:sub_label_font_color, label_width: label_width, label_align:label_align, warnings_font_family:warnings_font_family, warnings_font_style:warnings_font_style, warnings_font_size:warnings_font_size, warnings_font_color:warnings_font_color, warnings_background_color:warnings_background_color, warnings_show_border:warnings_show_border, warnings_border_style:warnings_border_style, warnings_border_thickness:warnings_border_thickness, warnings_border_color:warnings_border_color, warnings_shadow:warnings_shadow, tool_tip_font_family:tool_tip_font_family, tool_tip_font_style:tool_tip_font_style, tool_tip_font_size:tool_tip_font_size, tool_tip_font_color:tool_tip_font_color, tool_tip_background_color:tool_tip_background_color, tool_tip_show_border:tool_tip_show_border, tool_tip_border_style:tool_tip_border_style, tool_tip_border_thickness:tool_tip_border_thickness, tool_tip_border_color:tool_tip_border_color, tool_tip_shadow:tool_tip_shadow, tool_tip_below_font_family:tool_tip_below_font_family, tool_tip_below_font_style:tool_tip_below_font_style, tool_tip_below_font_size:tool_tip_below_font_size, tool_tip_below_font_color:tool_tip_below_font_color, tool_tip_below_shadow:tool_tip_below_shadow, show_footer:show_footer, footer_background:footer_background, footer_font_family:footer_font_family, footer_font_style:footer_font_style, footer_font_size:footer_font_size, footer_font_color:footer_font_color, submit_button_font_family:submit_button_font_family, submit_button_font_style:submit_button_font_style, submit_button_font_size:submit_button_font_size, submit_button_font_color:submit_button_font_color, submit_button_background_color:submit_button_background_color, submit_button_show_border:submit_button_show_border, submit_button_border_style:submit_button_border_style, submit_button_border_thickness:submit_button_border_thickness, submit_button_border_color:submit_button_border_color, submit_button_border_radius:submit_button_border_radius, submit_button_shadow:submit_button_shadow, submit_button_align:submit_button_align, predefined_submit_button_show:predefined_submit_button_show, predefined_submit_button_class:predefined_submit_button_class}, function(data) {

			if(data == 'affected') {

				if(id == 'tool-styling-preview') {

					var form_id = $('#form_id').val();
					var url		= base_path+'publish/form_preview/'+form_id;
					$.post(url, {}, function(data) {
						
						var data_array	= data.split('~');
						var status		= data_array[1];

						var Open_in_new_tab = '';
						if(status == 1) {
							Open_in_new_tab = '<a href="'+base_path+'publish/publish_form/'+form_id+'" id="new_tab_close" target="_blank">Open in a new tab</a>';
						}

						$('.main-loader').slideUp("slow", function() {
							$('#dialog').html('').html(data_array[0]).dialog({
								modal:true,
								minWidth: 830,
								dialogClass: 'fixed-dialog',
								title: 'Form Preview&nbsp;&nbsp;|&nbsp;&nbsp;'+Open_in_new_tab
							});
						});
					});
				}else if(id == 'back_to_next_step2') {

					var form_id = $('#form_id').val();

					$('.main-loader').slideUp("slow", function() {

						window.location.hash = 'show-payment-settings';
						return false;
//						window.location = base_path+'form/editform/'+form_id
					});
				}else if(id == 'next_step3') {
					
					var form_id = $('#form_id').val();

					$('#tool-styling-preview').hide();
					$('#tool-save-styling').hide();
					$('#tool-preview').show();
					$('#tool-settings').show();

					$('.main-loader').slideUp("slow", function() {
						window.location.hash = 'show-promotion-settings';
					});
				}else {
					$('.main-loader').slideUp("slow");
				}
			}else {
				$('.main-loader').slideUp("slow");
			}
		});

		return false;
	});

	$('#close-properties').live('click', function() {

		$('.label-error').remove();
		$('.field-preview-div').css('border', '');
		$('.preview').hide();
		$('.properties-table').slideUp('fast');
		$('.super-selected-li').removeClass('super-selected-li');

		//hide all the pointers if they are visible
		if($('.info-tip').length > 0){
			$('.info-tip').hide();
		}

		return false;
	});

	$('.tool-move').live('click', function() {

		$('#add-remove-field-icon').removeClass('minusIco').addClass('addIco');

		$('#loadedFields').slideUp('fast');

		$('.add_new_fields_info_inside').hide();

		$('.add_new_fields_info').show();

		return false;
	});

	$('#cancelFieldAdd').live('click', function(e){
		e.preventDefault();	
		$('#fld-feature-properties').fadeOut('fast', function(){
			$('.elementSelectList').fadeIn('fast');
			$('#fld-feature-properties').remove();
		});
	});

	//drop-down-template javascript

	$('#drop_down_templates').live('change', function() {

		var $instance	=	$(this);
		var url			=	base_path+'form/return_template_dropdown';
		var img_url		=	base_path+'images/loader2.gif';
		$instance.parents('.properties-table').find('div.add-remove-dropdown').html('').css('background', 'url("'+img_url+'") no-repeat center');

		if($instance.val() == 3){

			var year_html = '';
			for(var i = 2019; i > 1920; i--){
				year_html += '<div><input type="text" value="'+i+'" name="field_option"><a class="add-dropdown" href="#"></a><a class="remove-dropdown" href="#"></a></div>';
			}
			$instance.parents('.properties-table').find('div.add-remove-dropdown').html(year_html);
			$instance.parents('.properties-table').find('div.add-remove-dropdown').css('background', '');

			rearrange_dropdown($instance);

		}else{

			$.post(url, {value : $instance.val()},function(data){
				data = data.split(',');
				var final_html = '';
				for(var i = 0; i < data.length; i++){
					final_html += '<div><input type="text" value="'+data[i]+'" name="field_option"><a class="add-dropdown" href="#"></a><a class="remove-dropdown" href="#"></a></div>';
				}
				$instance.parents('.properties-table').find('div.add-remove-dropdown').html(final_html);
				$instance.parents('.properties-table').find('div.add-remove-dropdown').css('background', '');

				//live change trigger
				rearrange_dropdown($instance);
			});
		}
	});

	function rearrange_dropdown($instance) {

		//live change trigger
		var option_list = '';
		$instance.parents('.properties-table').find('.add-remove-dropdown').find('input[type=text]').each(function(){
			 option_list += '<option value="'+$(this).val()+'">'+$(this).val()+'</option>'; 				
		});
		$instance.parents('li').find('.tempe').next('select').html(option_list);	
	}

	//AUT0-SELECTION CODE
	$('#highlight-link').click( function(){SelectText('highlight-link'); });
	$('#highlight-html').click( function(){SelectText('highlight-html'); });
	$('#highlight-html-without-css').click( function(){SelectText('highlight-html-without-css'); });
	$('#highlight-script').click( function(){SelectText('highlight-script'); });
	  
	function SelectText(element) {
		var text = document.getElementById(element);
		if ($.browser.msie) {
			var range = document.body.createTextRange();
			range.moveToElementText(text);
			range.select();
		} else if ($.browser.mozilla || $.browser.opera) {
			var selection = window.getSelection();
			var range = document.createRange();
			range.selectNodeContents(text);
			selection.removeAllRanges();
			selection.addRange(range);
		} else if ($.browser.safari) {
			var selection = window.getSelection();
			selection.setBaseAndExtent(text, 0, text, 1);
		}
	}


	//TEMPLATE MANIPULATION

	$('.trigger-template').click(function(e){

		e.preventDefault();
		var clicked_id = this.id;
		var clicked_array = clicked_id.split('trigger-');
		var id = clicked_array[1];
		var to_show = 'template-'+id;
		$('.trigger-template').each(function(){
			var other_clicked = $(this).attr('id');
			var other_clicked_array = other_clicked.split('trigger-');
			var other = other_clicked_array[1];
			if(id == other){
				$(this).addClass('activeType');
			}else{
				$(this).removeClass('activeType');
			}
		});

		$('.individual-template-collection').each(function(){
			var current_id = $(this).attr('id');
			var current_id_array = current_id.split('template-');
			var current = current_id_array[1];
			if(id == current){
				$(this).fadeIn('fast');
			}else{
				$(this).hide();
			}		
		});
	});

	$('.trigger-template:first').click();

/*============================================ADD REMOVE ROWS====================================================================*/

	$(document).ready(function() {

		$('#add_email_grey').live('click', function() {

			$('.multiple-notification-upgrade-call').slideToggle('fast');
			return false;
		});

		$('#notifi_without_temp_free').live('click', function() {
			$('.notifi_without_temp_free').slideToggle('fast');
			return false;
		});

		$('#notification_without_form_name_free').live('click', function() {
			$('.notification_without_form_name_free').slideToggle('fast');
			return false;
		});

		$('#upgrade-enable-sms').live('click', function() {

			$('.sms-upgrade-call').slideToggle('fast');
			return false;
		});

		$('#upgrade-enable-autoresponder').live('click', function() {

			$('.auto-responder-upgrade-call').slideToggle('fast');
			return false;
		});

		$('#upgrade-enable-payment').live('click', function() {

			$('.payment-upgrade-call').slideToggle('fast');
			return false;
		});

		$('#info-tip-close').live('click', function(){
			$(this).parents('div.info-tip').fadeOut();
			return false;
		});
	
		$('.single-field').live('click', function() {

			if($('#add-remove-field-icon').hasClass('minusIco')) {

				$('#add-remove-field-icon').removeClass('minusIco').addClass('addIco');

				//$('#loadedFields').slideUp('fast');
			}
		});

		$('.add-radio').live('click', function() {

			$(this).parents('div.radio-container').after('<div class="radio-container"><input type="radio" name="radio-selected" class="live-radiobox-trigger"> <input type="text" name="field_option" class="live-radio-trigger"><a href="#" class="add-radio"></a><a href="#" class="remove-radio"></a></div>');

			//code that handles the live edit part
			$parent_div				= $(this).parents('.properties-table');
			$parent_single_field	= $(this).parents('.single-field');

			rearrange_radio($parent_div, $parent_single_field);

			return false;
		});

		$('.remove-radio').live('click', function() {

				var count = 0;

				//code that handles the live edit part
				$parent_div				= $(this).parents('.properties-table');
				$parent_single_field	= $(this).parents('.single-field');

				$(this).parents('.properties-table').find('div.add-remove-radio div').each(function(){
					count++;
				});

				if(count > 2){
					$(this).parent('div').remove();
					rearrange_radio($parent_div, $parent_single_field);
				}else {
					alert('Atleast two options are compulsory');
				}

				return false;	
		});

		//checkbox_templates javascript

		$('#radio_templates').live('change', function(){
		
			var $instance	=	$(this);
			var url			=	base_path+'form/return_template_radio';
			var img_url		=	base_path+'images/loader2.gif';
			$instance.parents('.properties-table').find('div.add-remove-radio').html('').css('background', 'url("'+img_url+'") no-repeat center');

			$.post(url, {value : $instance.val()},function(data){
				data = data.split(',');
				var final_html = '';
				for(var i = 0; i < data.length; i++){
					final_html += '<div class="radio-container"><input type="radio" checked="" value="'+data[i]+'" class="live-radiobox-trigger" name="radio-selected"> <input type="text" class="live-radio-trigger" value="'+data[i]+'" name="field_option"><a class="add-radio" href="#"></a><a class="remove-radio" href="#"></a></div>';
				}
				$instance.parents('.properties-table').find('div.add-remove-radio').html(final_html);
				$instance.parents('.properties-table').find('div.add-remove-radio').css('background', '');
				$parent_div = $instance.parents('.properties-table');
				$parent_single_field = $instance.parents('.single-field');
				rearrange_radio($parent_div, $parent_single_field);
			});

		});

		$('.field_alignment').live('change',function() {
			//code that handles the live edit part
			$parent_div				= $(this).parents('.properties-table');
			$parent_single_field	= $(this).parents('.single-field');
			if($parent_single_field.find('.all-check').length > 0){
				rearrange_check($parent_div, $parent_single_field, $(this).val());
			}else if($parent_single_field.find('.all-radio').length > 0){
				rearrange_radio($parent_div, $parent_single_field, $(this).val());
			}
		});
		
		function rearrange_radio(parent_div, parent_single_field, alignment) {

			if(alignment == undefined) {

					alignment = parent_div.find('.field_alignment').val();
				}

				to_fill = '<table border="0" cellpadding="0"  cellspacing="0" width="300px" class="all-radio">';

				if(alignment == 'Horizontal') {

					var temp_counter = 0;

					parent_div.find('.add-remove-radio :input[type=radio]').each(function() {

						temp_counter++;

						if(this.value == 'on') {

							this.value = '';
						}

						if($(this).is(':checked')) {

							to_fill += '<td width="32%"><input type="radio" name="display-radio" value="'+ this.value +'" checked> <span>'+ this.value +'</span></td>';
						}else {
						
							to_fill += '<td width="32%"><input type="radio" name="display-radio" value="'+ this.value +'"> <span>'+ this.value +'</span></td>';
						}

						if(temp_counter % 3 == 0) {

							to_fill += '<tr></tr>';
						}
					});

				}else {

					parent_div.find('.add-remove-radio :input[type=radio]').each(function() {

						if(this.value == 'on') {

							this.value = '';
						}

						if($(this).is(':checked')) {

							to_fill += '<tr><td><input type="radio" name="display-radio" value="'+ this.value +'" checked> <span>'+ this.value +'</span></td></tr>';

						}else {

							to_fill += '<tr><td><input type="radio" name="display-radio" value="'+ this.value +'"> <span>'+ this.value +'</span></td></tr>';
						}
					});
				}

				to_fill += '</table>';

				$parent_single_field.find('.all-radio').remove();
				$parent_single_field.find('.tempe').after(to_fill);
		}

		$('.live-radiobox-trigger').live('click', function() {

			//code that handles the live edit part
			$parent_div				= $(this).parents('.properties-table');
			$parent_single_field	= $(this).parents('.single-field');
			rearrange_radio($parent_div, $parent_single_field);
		});

		//to trigger live edit of individual radios
		$('.live-radio-trigger').live('keyup', function() {

			var current_edit = $(this).parents('.add-remove-radio div').index();

			var trigger_text = $(this).val();

			var radio_input_count = 0;
			
			$(this).parents('.single-field').find('.all-radio span').each(function(){
				
				if(current_edit == radio_input_count){
				
					$(this).html('').html(trigger_text);
				}
				radio_input_count++;
			});
		});

		//to sync the value of input box with the radio button

		$('.radio-container input').live('keyup',function() {

			$(this).parent().find('input:radio').attr('value',$(this).val());
		});


		$('.add-check').live('click', function() {

			$(this).parent('div').after('<div class="check-container"><input type="checkbox" class="js-ignore live-checkbox-trigger" name="check-selected"> <input type="text" name="field_option" class="live-check-trigger"><a href="#" class="add-check"></a><a href="#" class="remove-check"></a></div>');
			//code that handles the live edit part
			$parent_div				= $(this).parents('.properties-table');
			$parent_single_field	= $(this).parents('.single-field');

			rearrange_check($parent_div, $parent_single_field);

			return false;
		});

		$('.remove-check').live('click', function() {

			var count = 0;

			//code that handles the live edit part
			$parent_div				= $(this).parents('.properties-table');
			$parent_single_field	= $(this).parents('.single-field');

			$(this).parents('.properties-table').find('div.add-remove-check div').each(function() {
				count++;
			});
			if(count > 1) {
				$(this).parent('div').remove();
				rearrange_check($parent_div, $parent_single_field);
			}else {
				alert('Atleast one option is compulsory');
			}
			return false;
		});


		//checkbox_templates javascript

		$('#checkbox_templates').live('change', function() {

			var $instance	=	$(this);
			var url			=	base_path+'form/return_template_checkbox';
			var img_url		=	base_path+'images/loader2.gif';
			$instance.parents('.properties-table').find('div.add-remove-check').html('').css('background', 'url("'+img_url+'") no-repeat center');

			$.post(url, {value : $instance.val()},function(data) {

				data = data.split(',');
				var final_html = '';
				for(var i = 0; i < data.length; i++){
					final_html += '<div class="check-container"><input type="checkbox" value="'+data[i]+'" name="check-selected" class="js-ignore live-checkbox-trigger"> <input type="text" class="live-check-trigger" value="'+data[i]+'" name="field_option"><a class="add-check" href="#"></a><a class="remove-check" href="#"></a></div>';
				}
				$instance.parents('.properties-table').find('div.add-remove-check').html(final_html);
				$instance.parents('.properties-table').find('div.add-remove-check').css('background', '');

				//code that handles the live edit part
				$parent_div				= $instance.parents('.properties-table');
				$parent_single_field	= $instance.parents('.single-field');

				rearrange_check($parent_div, $parent_single_field);
			});
		});

		$('.live-checkbox-trigger').live('click', function() {

			//code that handles the live edit part
			$parent_div				= $(this).parents('.properties-table');
			$parent_single_field	= $(this).parents('.single-field');
			rearrange_check($parent_div, $parent_single_field);
		});

		$('.all-radio input').live('click', function(e){
			$(this).attr('checked', false);
		});

		$('.all-check input').live('click', function(e){
			$(this).attr('checked', false);
		});

		function rearrange_check(parent_div, parent_single_field, alignment) {

			if(alignment == undefined) {

					alignment = parent_div.find('.field_alignment').val();
			}

			to_fill = '<table border="0" cellpadding="0"  cellspacing="0" width="300px" class="all-check">';

			if(alignment == 'Horizontal') {

				var temp_counter = 0;

				parent_div.find('.add-remove-check :input[type=checkbox]').each(function() {

					temp_counter++;

					if(this.value == 'on') {
					
						this.value = '';
					}

					if($(this).is(':checked')) {

						to_fill += '<td width="32%"><input type="checkbox" class="js-ignore" name="display-check" value="'+ this.value +'" checked> <span>'+ this.value +'</span></td>';
					}else {
					
						to_fill += '<td width="32%"><input type="checkbox" class="js-ignore" name="display-check" value="'+ this.value +'"> <span>'+ this.value +'</span></td>';
					}

					if(temp_counter % 3 == 0) {

						to_fill += '<tr></tr>';
					}
				});
			}else {

				parent_div.find('.add-remove-check :input[type=checkbox]').each(function() {

					if(this.value == 'on') {

						this.value = '';
					}

					if($(this).is(':checked')) {

						to_fill += '<tr><td><input type="checkbox" name="display-check" value="'+ this.value +'" checked> <span>'+ this.value +'</span></td></tr>';

					}else {
					
						to_fill += '<tr><td><input type="checkbox" name="display-check" value="'+ this.value +'"> <span>'+ this.value +'</span></td></tr>';
					}
				});
			}

			to_fill += '</table>';

			$parent_single_field.find('.all-check').remove();
			$parent_single_field.find('.tempe').after(to_fill);
		}

		//to trigger live edit of individual radios
		$('.live-check-trigger').live('keyup', function() {

			var current_edit = $(this).parents('.add-remove-check div').index();

			var trigger_text = $(this).val();

			var check_input_count = 0;
			
			$(this).parents('.single-field').find('.all-check span').each(function(){
				
				if(current_edit == check_input_count){
				
					$(this).html('').html(trigger_text);
				}

				check_input_count++;
			});
		});

		//to sync the value of input box with the checkbox

		$('.check-container input').live('keyup',function(){
		
			$(this).parent().find('input:checkbox').attr('value',$(this).val());
		
		});

		$('.add-remove-dropdown input[type=text]').live('keyup', function() {
			$instance = $(this).parents('.add-remove-dropdown');
			rearrange_dropdown($instance);
		});

		$('.add-dropdown').live('click', function(){
				$(this).parent('div').after('<div><input type="text" name="field_option"><a href="#" class="add-dropdown"></a><a href="#" class="remove-dropdown"></a></div>');
				$('#field_default_dropdown').blur();
				return false;
		});

		$('.remove-dropdown').live('click', function(){
				var count = 0;
				$instance = $(this).parents('.add-remove-dropdown');
				$(this).parents('.properties-table').find('div.add-remove-dropdown div').each(function(){
						count++;
				});
				if(count > 2){
					$(this).parent('div').remove();
				}
				rearrange_dropdown($instance);
				$('#field_default_dropdown').blur();
				return false;	
		});

		$('#saveSubmitSettings').live('click', function() {

			var submit_text			=	$('#submit_text').val();
			var reset_button_flag	=	($('#reset_button_flag').is(':checked')) ? '1' : '0' ;
			var print_button_flag	=	($('#print_button_flag').is(':checked')) ? '1' : '0' ;
			var reset_text			=	$('#reset_text').val();
			var print_button_text	=	$('#print_button_text').val();

			var form_id	=	$('#form_id').val();

			var url = base_path+'form/save_submit_settings';

			$.post(url, {form_id : form_id, submit_text : submit_text, reset_button_flag : reset_button_flag, reset_text : reset_text, print_button_flag : print_button_flag, print_button_text : print_button_text}, function(data){
				$('.field-preview-div').css('border', '');
				$('.preview').hide();

				$('.properties-table').slideUp('fast');
			});
			return false;
		});

		var already_shown_pointer_14 = false;

		$('#addFieldSubmit').live('click', function() {

			if(!$('#add-remove-field-icon').hasClass('addIco')) {
				$('#add-remove-field-icon').removeClass('minusIco').addClass('addIco');
				$('#loadedFields').slideUp('fast');
				$('.add_new_fields_info').show();
			}

			//hide all the pointers if they are visible
			if($('.info-tip').length > 0){
				$('.info-tip').hide();
			}

			var properties = {};
			var field_choices = {};
			var check_selected = {};
			var multiple_field_counter = 0;
			var edit_flag = '';
			var form_fields_unique_id = '';
			var special_variable = '';
			var radio_checked_flag = '';
			$parent_div = $(this).parents('.single-field');

			if($parent_div.find('input[name=field_label]').length != 0){				
				var label = $parent_div.find('input[name=field_label]').val();
				if(label.toLowerCase().indexOf("password") >= 0 || label.toLowerCase().indexOf("passwrd") >= 0 || label.toLowerCase().indexOf("pass-word") >= 0) {
					$parent_div.find('.label-error').remove();
					$parent_div.find('.field-preview-div').after('<div class="label-error error-new-div">To prevent phising, the use of "password" in the label field has been disabled</div>');
					$parent_div.find('.label-error').show();
					return false;
				}
			}

			if($parent_div.find('input[name=image_source]').length != 0){				
				var image_name = $parent_div.find('input[name=image_source]').val();
				if(image_name == '') {
					$parent_div.find('.label-error').remove();
					$parent_div.find('.image-wrapper').after('<div class="label-error error-new-div">Upload image value cannot be left blank. Please upload/select an image using the browse button</div>');
					$parent_div.find('.label-error').show();
					return false;
				}
			}
	
			if($(this).hasClass('edit-save')) {

				$('.field-preview-div').css('border', '');
				$('.preview').hide();
			
				var $inputs = $(this).parents('.single-field').find('.properties-table :input');

				var id_original = $(this).parents('.single-field').find('.properties-table').attr('id');
				var id_array = id_original.split('properties-');
				var id = id_array[1];

				var form_fields_unique_id = id;

				edit_flag = 'yes';

				if($(this).hasClass('handle-dropdown')){
				
					special_variable = 'handle-dropdown';
				
				}else if($(this).hasClass('handle-radio')){
				
					special_variable = 'handle-radio';
				}
			}else {
			
				var $inputs = $('#properties-table :input');
			}

			$inputs.each(function(){

				if($(this).attr('type') == 'checkbox'){

				  if(!$(this).hasClass('js-ignore')){

						if($(this).is(':checked')){

							properties[this.name] = 'checked';	

						}else{

							properties[this.name] = '';	
						}
				  }
				}else{			
					//condition if multiple values eg. dropdown,checkboxes
					if(this.name == 'field_option'){

						field_choices[multiple_field_counter] = $(this).val();
						
						multiple_field_counter++;

					}else if(this.name == 'radio-selected'){		//condition to get which radio is checked
					
						if($(this).is(':checked')){
						
							properties[this.name] = $(this).val();
							radio_checked_flag = 'yes';

						}else if(radio_checked_flag == ''){
						
							properties[this.name] = '';
						}
					}else{
						
						//condition code so that array is not filled with default time values that dont exist

						if($(this).parent().parent().attr('id') == 'default_time_container'){
							
							if($(this).parent().attr('style') == 'display: block;'){

								properties[this.name] = $(this).val();
							}
						}else{
						
							properties[this.name] = $(this).val();
						}
					}
				}
				properties['field_choices'] = field_choices;
			});

			//if check-box then populate check-selected array

			$(this).parents('.properties-table').find('.add-remove-check input:checkbox').each(function(e){
			
				if($(this).is(':checked')){
					
					check_selected[e] = $(this).val();

				}else {
					
					check_selected[e] = '';
				}
			});

			properties['field_checked'] = check_selected;

			if(edit_flag == 'yes'){
				var url = base_path+'form/update_to_form';
			}else{
				var url = base_path+'form/add_to_form';
			}

			var no_of_fields_on_form = 0;
			$('#sortable input.ordering').each(function(){
				no_of_fields_on_form++;		
			});

			var position_between = $('#sortable .add-field-position').val();

			var tag = $(this).attr('rel');

			var position = (parseInt(no_of_fields_on_form)+1);
			$.post(
				url, 
				{
					form_id : $('#form_id').val(),
					position : position,
					form_unique_id : $('#form_unique_id').val(),
					tag_item : $('#tag_item').val(),
					field_unique_id : $('#field_unique_id').val(),
					form_fields_unique_id : form_fields_unique_id,
					tag	: tag,
					properties : properties
				}, 
				function(data){
					$parent_div.find('.label-error').remove();
					var data_split = data.split('~');
					if(data_split[0] == 'edit-updated'){

						if(special_variable == 'handle-dropdown'){

							var to_fill = '';

							$parent_div.find('.add-remove-dropdown :input').each(function(){
							
								to_fill += '<option value="'+ this.value +'">'+ this.value +'</option>';
							});

							$parent_div.find('select[name=field_default_dropdown]').html('').html(to_fill);
						}

						$('.field-preview-div').css('border', '');
						$('.preview').hide();
						$('.properties-table').slideUp('fast', function(){
							if($('#number_of_forms').val() == 1){
								if($('#sortable li').length == 2){
									if(!already_shown_pointer_14){
										$('.info-tip').hide();
										setTimeout(function(){
											var $next_step = $('#next_step');

											var next_step_top = eval($next_step.offset().top-190);
											var next_step_left = eval($next_step.offset().left+20);

											$("#info-14").css("top", next_step_top+"px").css("left", next_step_left+"px").fadeIn();

											already_shown_pointer_14 = true;
										}, 1000);
									}
								}
							}							
						});

						//$parent_div.stop().animate({ backgroundColor: "#DBF2FF !important" }, 800).animate({ backgroundColor: "#ffffff" }, 800);
						$parent_div.stop().effect("highlight", {color : '#DBF2FF' }, 800);

						//reassign the order
						$('#sortable input.ordering').each(function(i) {
							i++;
							$(this).val(i);					
						});

					}else {

						if(position_between == 'between') {

							$('#loadedFields').slideUp('fast');
							$('#addFieldDiv').removeClass().addClass('down');
							$('#loadedFields').after(data);

							var to_highlight_div = $('#loadedFields').prev('li').index();
							$('#sortable li:eq('+parseInt(to_highlight_div+1)+')').stop().effect("highlight", {color : '#DBF2FF' }, 800);
						
							//reassign the order
							$('#sortable input.ordering').each(function(i){
								i++;
								$(this).val(i);					
							});
						}else{

							$('#loadedFields').slideUp('fast');
							$('#addFieldDiv').removeClass().addClass('down');
							var current_sortable_size = $('#sortable li').size();
							var insert_pos = parseInt(current_sortable_size-1);
							$('#sortable li:eq('+insert_pos+')').before(data);
							$(window).scrollTop(parseInt($('#sortable li:eq('+insert_pos+')').offset().top-40));	
							$('#sortable li:eq('+insert_pos+')').stop().effect("highlight", {color : '#DBF2FF' }, 800);
						}
					}
																	   
					$('.super-selected-li').removeClass('super-selected-li');

					var url_2 = base_path+'form/force_cache_creation/'+$('#form_id').val();
					$.post(url_2, {}, function(data){});
				}
			);
			return false;
		});

		$(function() {

			$("#sortable").sortable({
				opacity: 0.40,
				axis: 'y',
				items: "li:not(.dont-move)",
				start: function(event, ui){

					//hide all the pointers if they are visible
					if($('.info-tip').length > 0){
						$('.info-tip').hide();
					}

					$('.tipsy').hide();					
					$(this).sortable('refreshPositions');
	
					ui.item.css('height', 'auto');
					$('.properties-table').each(function(){
						$(this).hide();
					});

					$('#sortable li').each(function(){
						$(this).removeClass('super-selected-li');
					})

					//give it a class selected
					$(ui.item).addClass('super-selected-li');

					var item_height = $(ui.item).height();

					if ($.browser.msie) {
						//item_height = eval(item_height+3);
					}

					$('.ui-state-highlight-placeholder').css('height', item_height);

					$('#loadedFields').hide();

					if($('#add-remove-field-icon').hasClass('addIco')) {

					}else {

						$('#add-remove-field-icon').removeClass('minusIco').addClass('addIco');

						$('.add_new_fields_info').show();

						$('#loadedFields').slideUp('fast');
					}
				},
				forcePlaceholderSize: true,
				handle: '.tool-move',
				placeholder: "ui-state-highlight-placeholder",
				update: function(event, ui) {
					$('#sortable input.ordering').each(function(i){
						i++;
						$(this).val(i);					
					});
				},
				/*stop: function (event, ui) {
					ui.item.trigger('click');
				},
				*/
				cursor: "move",
				revert: true
			});
			$( "#draggable" ).draggable({
				containment: 'window',
				connectToSortable: "#sortable",
				revert: "invalid",
				scroll: true,
				refreshPositions: true
			});
		});

		$('#field_default_dropdown').live('focus', function(){

			var fly_options = '';
			$(this).find('option').each(function(i, option){ $(option).remove(); });
			$(this).parents('.properties-table').find('.add-remove-dropdown :input').each(function(){
				fly_options += '<option value="'+this.value+'">'+this.value+'</option>';
			});
			$(this).html('').append(fly_options);
		});

		$('#field_default_dropdown').live('change', function(){
			$(this).parents('li').find('.tempe').next('select').val($(this).val());
		});

	});

	//change default date format accordingly
	$(function(){

		$('.field_time_format').live('change', function() {

			var clicked_option = $(this).val();

			$parent = $(this).parents('.single-field').find('.actual-time');

			var hours	= $(this).parents('.single-field').find('.hours_trigger').val();
			var minutes	= $(this).parents('.single-field').find('.minutes_trigger').val();
			var seconds = $(this).parents('.single-field').find('.seconds_trigger').val();

			var url = base_path+'form/return_time_field';

			$.post(url, {clicked_option : clicked_option}, function(data) {

				data = data.replace("hours_text", hours);
				data = data.replace("minutes_text", minutes);
				data = data.replace("seconds_text", seconds);

				$parent.html('').html(data);
			});
			return false;
		});
	});

	//change default time format accordingly
	$(function() {

		$('#field_phone_format').live('change', function() {

			var clicked_option = $(this).val();
		
			$parent = $(this).parents('.single-field').find('.actual-phone');

			var url = base_path+'form/return_phone_field';

			$.post(url, {clicked_option : clicked_option}, function(data){
			
				$parent.html('').html(data);
			});
			return false;
		});
	});

	//Save Form Code

	$('#tool-save').live('click', function() {

		var form_id = $('#form_id').val();

		$('#sortable input.ordering').each(function(i) {
			i++;
			$(this).val(i);
		});

		if(form_id != '') {

			var new_order = {};

			$('#sortable input.ordering').each(function() {
				new_order[this.id] = $(this).val();
			});

			$('#tool-save').html('Saving...');
			$('.main-loader').slideDown("slow");

			//send the styling parameters also
			var show_header		 = ($('#style-adv-header-editor').is(':checked')) ? '1' : '0' ;

			var form_show_border = ($('#style-adv-border-editor').is(':checked')) ? '1' : '0' ;

			var show_footer		 = ($('#style-adv-footer-editor').is(':checked')) ? '1' : '0' ;

			var label_align = '';
			$('.label-align').each(function() {
				 if($(this).is(':checked')) {
					label_align = $(this).val();
				 }
			});

			var url = base_path+'form/save_order';

			$.post(
				url, 
				{
					form_id			 : form_id,
					new_order		 : new_order,
					show_header		 : show_header,
					form_show_border : form_show_border,
					show_footer		 : show_footer,
					label_align		 : label_align
				
				}, function(data) {

					$('#tool-save').html('Save');
					$('.main-loader').slideUp("slow");

					$('#saving-loader').fadeOut("fast",function() {
						$('#save-btn').css("color", '#2B6595');
					});
				}
			);
		}else {
			return false;
		}
		return false;
	});


	//VIEW PREVIEW CODE
	$('#tool-preview').live('click', function() {

		if($('#form_id').val() != '') {

			if($(this).hasClass('get-form-code')) {

			}else if($(this).hasClass('tool-settings-preview')) {
//				$('#tool-settings').click();
			}else {
				$('#tool-save').click();
			}

			var form_id = $('#form_id').val();
			var url		= base_path+'publish/form_preview/'+form_id;

			$.post(url, {}, function(data) {

				var data_array	= data.split('~');
				var status		= data_array[1];

				var Open_in_new_tab = '';
				if(status == 1) {
					Open_in_new_tab = '<a href="'+base_path+'publish/publish_form/'+form_id+'" id="new_tab_close" target="_blank">Open in a new tab</a>';
				}

				$('#dialog').html(data_array[0]).dialog({
					modal:true,
					minWidth: 830,
					resizable: false,
					closeOnEscape: true,
					autoResize: false,
					draggable: false,
					zIndex: 12000,
					dialogClass: 'fixed-dialog',
					title: 'Form Preview&nbsp;&nbsp;|&nbsp;&nbsp;'+Open_in_new_tab
				});
			});
			//prevent the browser to follow the link
			return false;
		}else {
			return false;
		}
	});

	//Close modal preview then proceed to new tab
	$('#new_tab_close').live('click', function() {
		$('#dialog').dialog('close');
	});

	//VIEW PREVIEW CODE
	$('#redirect_url_preview').live('click', function() {

		var form_id = $('#form_id').val();

		if(form_id != '') {
		
			var url = base_path+'publish/redirect_url_preview/'+form_id;

			$.post(url, {}, function(data) {

				$('#dialog').html('').html(data).dialog({
					modal: true,
					minWidth: 830,
					dialogClass: 'fixed-dialog',
					title: 'Enter your domain details'
				});
			});
			//prevent the browser to follow the link
			return false;
		}else {
			return false;
		}
	});

	//DELETE field from form CODE

	$('#delete-field').live('click', function() {

		$('.tipsy').remove();

		//hide all the pointers if they are visible
		if($('.info-tip').length > 0){
			$('.info-tip').hide();
		}

		$('#add-remove-field-icon').removeClass('minusIco').addClass('addIco');

		$('#loadedFields').slideUp('fast');

		$('.add_new_fields_info_inside').hide();

		$('.add_new_fields_info').show();

		if(confirm('Are you sure you want to delete this field. This action CANNOT be undone.'))
		{
			var li_id = $(this).parents('li').attr('id');
			var li_id_array = li_id.split('-');

			var id = li_id_array[1];
			var form_id = $('#form_id').val();

			var url = base_path+'form/delete_field';

			$.post(
				url,
				{
					form_id : form_id,
					id : id
				}, 
				function(data) {
					$('#'+li_id).fadeOut("fast",function() {
						$(this).remove();
					});

					var no_of_fields_on_form = 0;
					$('#sortable li').each(function() {
						no_of_fields_on_form++;		
					});

					if(no_of_fields_on_form == 2) {
						//$('#add-remove-field-icon').removeClass('addIco').addClass('minusIco');
						//onload();
					}
				}
			);
			return false;
		}else {
			return false;
		}
	});

	//VIEW PREVIEW CODE
	$('#form_warnings').live('click', function() {

		if($('#form_id').val() != '') {

			var url		= $(this).attr('href');
			var form_id = $('#form_id').val();

			$.post(url, {}, function(data) {

				$('#dialog').html(data).dialog({
					modal:true,
					minWidth: 720,
					resizable: false,
					closeOnEscape: true,
					autoResize: false,
					draggable: false,
					zIndex: 12000,
					dialogClass: 'fixed-dialog',
					title: 'Edit Form Warnings'
				});
			});
			//prevent the browser to follow the link
			return false;
		}else {
			return false;
		}
	});


	//Show selected on mouseover of LI

	$('#sortable').delegate('li','mouseover',function(){

		//need this condition or function is triggred for the placeholder li 
		if(!$(this).hasClass('ui-state-highlight-placeholder')){

			var li_id_array = $(this).attr('id').split('-');
			var id = li_id_array[1];								//get the id eg. sandKLAnsakndlask232sdn

			var container_div  = 'container-'+id;
			var properties_div = 'properties-'+id;

			//save value in hidden input
			$('#selected_field').val(container_div);

			//remove styles from existing divs
			$('#sortable li').each(function(){
				$(this).css('border', '1px solid #f6f6f6').css('background', 'none');
				$(this).removeClass('selected-li');
			})

			//give it a class selected
			$(this).addClass('selected-li');

			//style the div
			$(this).css('border', '1px dashed #dadada').css('background', '#EAF6FF');


			$('.options-div').hide();
			$('.edit-field-floating').hide();
			$('.add-field-top').hide();
			$('.add-field-bottom').hide();	
			if(!$(this).find('.properties-table').is(':visible')){
				$(this).children('.single-field').children('.add-field-top').show();
				$(this).children('.single-field').children('.add-field-bottom').show();
			}
			if(!$('#'+properties_div).is(":visible")){
				$(this).children('.single-field').children('.edit-field-floating').show();
			}
			$(this).children('.single-field').children('.options-div').show();

			if($(this).hasClass('super-selected-li') && $('#'+properties_div).is(":visible")){
				$(this).children('.single-field').children('.edit-field-floating').hide();
			}
		}
	});

	var add_field_top_bottom = false;
	var sortable_flag		 = false;

	$('.add-field-top').mouseover(function(){

		add_field_top_bottom = true;

	}).mouseout(function(){

		add_field_top_bottom = false;

	});

	$('.add-field-bottom').mouseover(function(){

		add_field_top_bottom = true;

	}).mouseout(function(){

		add_field_top_bottom = false;
	});

	$('#sortable').mouseover(function(){

		sortable_flag = true;

	}).mouseout(function() {

		sortable_flag = false;
	});

	$('.edit-field-floating').live('click', function(e) {

		e.preventDefault();
		$('#add-remove-field-icon').removeClass('minusIco').addClass('addIco');

		$('#loadedFields').slideUp('fast');

		$('.add_new_fields_info_inside').hide();

		$('.add_new_fields_info').show();

		$('.field-preview-div').css('border', '');
		$('.preview').hide();
		$(this).parent().find('.field-preview-div').css('border', '1px solid #dadada');
		$(this).parent().find('.preview').show();

		$parent_li		= $(this).parents('li');

		var li_id_array = $parent_li.attr('id').split('-');
		var id = li_id_array[1];												//get the id eg. sandKLAnsakndlask232sdn

		var container_div  = 'container-'+id;
		var properties_div = 'properties-'+id;
		
		//save value in hidden input
		$('#selected_field').val(container_div);

		//remove styles from existing divs
		$('#sortable li').each(function(){
			$(this).removeClass('super-selected-li');
		});

		//give it a class selected
		$parent_li.addClass('super-selected-li');

		$('.options-div').hide();
		$('.add-field-top').hide();
		$('.add-field-bottom').hide();	
		$(this).children('.single-field').children('.add-field-top').show();
		$(this).children('.single-field').children('.add-field-bottom').show();
		$(this).children('.single-field').children('.options-div').show();

		$('#loadedFields').slideUp();
		$('.properties-table').each(function(){
			if($(this).attr('id') != properties_div){
				$(this).slideUp('fast');
			}else{
				$(this).slideDown('fast');
			}
		});
	});

	$('#sortable li').live('click', function(){

		var li_id_array = $(this).attr('id').split('-');
		var id = li_id_array[1];												//get the id eg. sandKLAnsakndlask232sdn

		var container_div  = 'container-'+id;
		var properties_div = 'properties-'+id;

		$('.properties-table').each(function(){
			if($(this).attr('id') != properties_div){
				$(this).slideUp('fast');
			}
		});

		/*if(add_field_top_bottom == false){
			$('#loadedFields').slideUp('fast');
		} */

		$('#sortable li').each(function(){
			$(this).removeClass('super-selected-li');
		});

		$(this).addClass('super-selected-li');

	});

	$('body').live('click', function() {

		//$("#addField").arrow("destroy");

		/*if(sortable_flag == false) {

			$(this).parent().find('.field-preview-div').css('border', '');
			$(this).parent().find('.preview').hide();


			$('#sortable li').each(function(){
				$(this).removeClass('super-selected-li');
			});	
			
			$('.label-error').remove();
			$('#close-properties').click();
			$('.options-div').hide();
			$('.edit-field-floating').hide();
			$('.add-field-top').hide();
			$('.add-field-bottom').hide();	
		}	*/ 
	
	});

	$('.ui-widget-overlay').live("click", function() {
		//Close the dialog
		$("#dialog").dialog("close");
	});

	$('.close_add_field').live('click', function() {

		if($('#add-remove-field-icon').hasClass('minusIco')) {
	
			$('#add-remove-field-icon').removeClass('minusIco').addClass('addIco');
			$('#loadedFields').slideUp('fast');
		}

		$('.add_new_fields_info_inside').hide();
		$('.add_new_fields_info').show();

		$('#loadedFields').slideUp('fast');
		$('.loaded-fields').slideUp('fast');

		$('#info-8').hide();
		$('#info-9').hide();

		return false;
	});

	//ADDING FIELDS ON TOP AND BOTTOM
	var top_or_bottom = '';

	$(function(){

		$('.add-field-top').live('click', function(e){

			e.preventDefault();
			$('#add-remove-field-icon').removeClass('minusIco').addClass('addIco');
			$('.add_new_fields_info').show();
			$('.add_new_fields_info_inside').hide();

			$('.field-preview-div').css('border', '');
			$('.preview').hide();
			$('.properties-table').slideUp();
			$('#loadedFields').remove();
			$('.loaded-fields').slideUp('fast', function(){
				$(this).remove();
			});

			var top_or_bottom = $(this).parents('li').index()+'~top';
			$('#top_or_bottom').val(top_or_bottom);

			var loaded_fields = $('#loadFieldsArr-template').html();
			var new_div =  '<div id="loadedFields" class="innerBlock loaded-fields">'+loaded_fields+'</div>';

			$('.demo').find('li.selected-li').before(new_div);
			$('#sortable .loaded-fields').find('input[name=add-field-position]').val('between');
			$('.loaded-fields').slideDown('fast');

		});

	
		$('.add-field-bottom').live('click', function(e) {

			e.preventDefault();
			$('#add-remove-field-icon').removeClass('minusIco').addClass('addIco');
			$('.add_new_fields_info').show();
			$('.add_new_fields_info_inside').hide();

			$('.field-preview-div').css('border', '');
			$('.preview').hide();
			$('.properties-table').slideUp();
			$('#loadedFields').remove();
			$('.loaded-fields').slideUp('fast', function(){
				$(this).remove();
			});	

			var top_or_bottom = $(this).parents('li').index()+'~bottom';
			$('#top_or_bottom').val(top_or_bottom);

			var loaded_fields = $('#loadFieldsArr-template').html();
			var new_div =  '<div id="loadedFields" class="innerBlock loaded-fields">'+loaded_fields+'</div>';

			$('.demo').find('li.selected-li').after(new_div);
			$('#sortable .loaded-fields').find('input[name=add-field-position]').val('between');
			$('.loaded-fields').slideDown('fast'); 
		});
	});

/*===============================================================================================================================*/


/*===============================================================================================================================*/		
	$('#addfields').bind('click', clickAction);
/*===============================================================================================================================*/	
});	
/******** document onload Function Ends.*************/

/********* Custom Functions Starts ******************/

/*===This Function is used to load the fields when left side add fields link is clicked. =========================================*/
	var no_of_fields_on_form = 0;
	$('#sortable li').each(function() {
		no_of_fields_on_form++;		
	});

	if(no_of_fields_on_form == 1) {

		var loaded_fields = $('#loadFieldsArr-template').html();
		$('#loadedFields').slideUp('fast', function(){
			$(this).remove();
		});
		var new_div =  '<div id="loadedFields" class="innerBlock fltrt">'+loaded_fields+'</div>';
		$('#addFieldDiv').append(new_div);

		$('.field-preview-div').css('border', '');
		$('.preview').hide();
		$('#add-remove-field-icon').removeClass('minusIco').addClass('addIco');
		$('.add_new_fields_info').show();
		//$('#loadedFields').slideDown('fast');
		$('.properties-table').slideUp('fast');
	}

	function clickAction() {

		//hide all the pointers if they are visible
		if($('.info-tip').length > 0){
			$('.info-tip').hide();
		}

		var loaded_fields = $('#loadFieldsArr-template').html();
		$('#loadedFields').slideUp('fast', function(){
			$(this).remove();
		});

		var new_div =  '<div id="loadedFields" class="innerBlock fltrt">'+loaded_fields+'</div>';
		
		$('#addFieldDiv').append(new_div);

		if($('#add-remove-field-icon').hasClass('addIco')) {

			$('.add_new_fields_info').show();
			$('.add_new_fields_info_inside').show();
			$('#add-remove-field-icon').removeClass('addIco').addClass('minusIco');
			$('.add_new_fields_info').hide();
			$('#loadedFields').slideDown('fast', function(){
			
				//code that displays the pointers for the types of fields explaination
				if($('#sortable li').length == 1){
					if($('#number_of_forms').val() == 1){
						if($("#info-7").length > 0){
							$("#info-7").hide();

							var off_top = eval($('#fld-8').offset().top+10);
							var off_left = eval($('#fld-8').offset().left-255);
							$("#info-8").css("top", off_top+"px").css("left", off_left+"px").fadeIn();

							var off_top = eval($('#fld-1').offset().top+10);
							var off_left = eval($('#fld-1').offset().left-255);
							$("#info-9").css("top", off_top+"px").css("left", off_left+"px").fadeIn();
						}
					}
				}
			});
			$('.field-preview-div').css('border', '');
			$('.preview').hide();
			$('.properties-table').slideUp('fast');

		}else {
	
			$('.add_new_fields_info_inside').hide();
			$('#add-remove-field-icon').removeClass('minusIco').addClass('addIco');
			$('.add_new_fields_info').show();
			$('#loadedFields').slideUp('fast');
		}
		return false;
	}
/*========================================================================================================================*/

/*======When user click on the individual field then this function will load the preview, description, etc====================*/
	function clickActionButton(fuid, fid) {

		var form_id			= $('#form_id').val();
		var form_unique_id	= $('#form_unique_id').val();
		var position		= $('#sortable .add-field-position').val();
		var url				= base_path+'form/generateFDescription';
		var data			= 'field_unique_id='+fuid+'&field_id='+fid+'&position='+position+'&form_id='+form_id+'&form_unique_id='+form_unique_id;
		var clickedId		= 'fld-'+fid;

		$('#sortable input.ordering').each(function(i) {
			i++;
			$(this).val(i);
		});

		//hide the tooltips of standard an technical fields
		if($('#info-8').length > 0) {
			$('#info-8').hide();
			$('#info-9').hide();
		}

		$.ajax({
			'type'		: 'POST',
			'url'		: url,
			'data'		: data,
			'success'	: function(txt) {

				$('#sortable li').each(function(i) {
					$(this).removeClass('super-selected-li');					
				});

				$('.loaded-fields').slideUp('fast').remove();
				$('#loadedFields').slideUp('fast').remove();
				$('.add_new_fields_info').show();
				$('.add_new_fields_info_inside').hide();

				$('#add-remove-field-icon').removeClass('minusIco').addClass('addIco');

				if(position != 'between') {

					$('#sortable li').last().before(txt);

					var last_offset = $('#sortable li').last().prev('li').offset().top;
					$("html:not(:animated),body:not(:animated)").animate({scrollTop: last_offset-20}, 500);

					$('#sortable li').last().prev('li').addClass('super-selected-li');

					$('#sortable li').last().prev('li').find('.properties-table').slideDown(function() {

						if($('#sortable li').length == 2) {

							//function to add pointers
							if(fuid == 'Tag15') {
								var $preview_div = $(this).siblings('.image-wrapper');
							}else if(fuid == 'Tag13') {
								var $preview_div = $(this).siblings('.actual-heading');
							}else {
								var $preview_div = $(this).siblings('.field-preview-div');
							}

							var preview_top = $preview_div.offset().top;
							var preview_left = $preview_div.offset().left;
							var preview_width = $preview_div.width();

							var properties_top = $(this).offset().top;
							var properties_left = $(this).offset().left;

							var submit_top = $(this).find('#addFieldSubmit').offset().top;
							var submit_left = $(this).find('#addFieldSubmit').offset().left;

							var info_10_left = eval(preview_left-240);
							var info_10_top = eval(preview_top-12);
							$('#info-10').css('top', info_10_top+'px').css('left', info_10_left+'px').fadeIn();

							var info_11_left = eval(preview_left+preview_width-125);
							var info_11_top = eval(preview_top-135);
							$('#info-11').css('top', info_11_top+'px').css('left', info_11_left+'px').fadeIn();

							var info_12_left = eval(properties_left-240);
							var info_12_top = eval(properties_top+70);
							$('#info-12').css('top', info_12_top+'px').css('left', info_12_left+'px').fadeIn();

							var info_13_left = eval(submit_left-57);
							var info_13_top = eval(submit_top+55);
							$('#info-13').css('top', info_13_top+'px').css('left', info_13_left+'px').fadeIn();
						}
					});

					$('#sortable li').last().prev('li').find('.single-field').stop().effect("highlight", {color : '#DBF2FF'}, 800);

					$('#sortable li').last().prev('li').find('.field-preview-div input[type=text], .field-preview-div textarea').each(function(e) {
						$(this).attr('disabled', true);
						$(this).css({'background' : '#ffffff', 'border' : '1px solid #7F9DB9', 'padding' : '2px'});
					});

				}else {

					var top_or_bottom = $('#top_or_bottom').val();

					if(top_or_bottom != '') {
						
						var top_or_bottom_array = top_or_bottom.split('~');
						var old_index			= top_or_bottom_array[0];
						var new_position		= top_or_bottom_array[1];

						if(new_position == 'top') {

							elm = $('#sortable li').eq(old_index);
							elm.before(txt);
							//new_index = old_index + 1;
							n_elm = elm.prev();
							var last_offset = n_elm.offset().top;
							$("html:not(:animated),body:not(:animated)").animate({scrollTop: last_offset-20}, 500);
							
							n_elm.addClass('super-selected-li');
							n_elm.find('.properties-table').slideDown();
							n_elm.find('.single-field').stop().effect("highlight", {color : '#DBF2FF'}, 800);
							n_elm.find('.field-preview-div input[type=text], .field-preview-div textarea').each(function(e){
								$(this).attr('disabled', true);
								$(this).css({'background' : '#ffffff', 'border' : '1px solid #7F9DB9', 'padding' : '2px'});
							});

						}else {

							elm = $('#sortable li').eq(old_index)
							elm.after(txt);
							n_elm = elm.next();
							var last_offset = n_elm.offset().top;
							$("html:not(:animated),body:not(:animated)").animate({scrollTop: last_offset-20}, 500);

							n_elm.addClass('super-selected-li');
							n_elm.find('.properties-table').slideDown();
							n_elm.find('.single-field').stop().effect("highlight", {color : '#DBF2FF' }, 800);
							n_elm.find('.field-preview-div input[type=text], .field-preview-div textarea').each(function(e) {
								$(this).attr('disabled', true);
								$(this).css({'background' : '#ffffff', 'border' : '1px solid #7F9DB9', 'padding' : '2px'});
							});
						}
					}
				}

				$('#sortable input.ordering').each(function(i){
					i++;
					$(this).val(i);					
				});

				var label_alignment = '';
				$('.label-align').each(function() {
					 if($(this).is(':checked')){
						 label_alignment = $(this).val();
					 }
				});

				//align according to the settings
				set_label_align(label_alignment);

				$('#tool-save').click();
			}
		});
	}

	function add_custom_amount_field(fuid, fid) {

		var form_id			= $('#form_id').val();
		var form_unique_id	= $('#form_unique_id').val();
		var position		= $('#sortable .add-field-position').val();
		var url				= base_path+'form/generate_amount_field';
		var data			= 'field_unique_id='+fuid+'&field_id='+fid+'&position='+position+'&form_id='+form_id+'&form_unique_id='+form_unique_id;
		var clickedId		= 'fld-'+fid;

		$('.main-loader').slideDown("slow");

		$.ajax({
			'type'		: 'POST',
			'url'		: url,
			'data'		: data,
			'success'	: function(form_fields_unique_id) {

				$('.main-loader').slideUp("slow");

				form_fields_unique_id = form_fields_unique_id+'|Amount';

				$('#custom_amount_check').attr('rel', form_fields_unique_id);

				$('#custom_amount_message').removeClass('custom_amount_delete');
				$('#custom_amount_message').addClass('custom_amount_add');

				$('#custom_amount_message').html('Your Donation/Custom amount field has been added to your form, you can re-arrange its position from <a href="'+base_path+'form/editform/'+form_id+'">Form Editor page!</a>').show();

				save_payment_settings();
			}
		});
	}

/********* Custom Functions Ends ******************/


/*=====================WATERMARK JQUERY [minified] FUNCTION======================================================*/

(function($){$.fn.watermark=function(c,t){var e=function(e){var i=$(this);if(!i.val()){var w=t||i.attr('title'),$c=$($("<div />").append(i.clone()).html().replace(/type=\"?password\"?/,'type="text"')).val(w).addClass(c);i.replaceWith($c);$c.focus(function(){$c.replaceWith(i);setTimeout(function(){i.focus();},1);}).change(function(e){i.val($c.val());$c.val(w);i.val()&&$c.replaceWith(i);}).closest('form').submit(function(){$c.replaceWith(i);});}};return $(this).live('blur change',e).change();};})(jQuery);

/*=====================WATERMARK JQUERY [minified] FUNCTION END==================================================*/


/*------------------- UP/DOWN arrow code ---------------------------*/

$(document).ready(function() {

	//image functions
	$('.change-image').live('click', function() {

		var url		= base_path+'form/get_image_form';
		var form_id = $('#form_id').val();
		var form_field_unique_id = $(this).parents('.properties-table').attr('id').split('properties-')[1];

		$.post(url, {form_id : form_id, form_field_unique_id : form_field_unique_id}, function(data) {

			$('#dialog').html(data).dialog({
				modal:true,
				minWidth: 600,
				resizable: false,
				closeOnEscape: true,
				autoResize: false,
				draggable: false,
				zIndex: 12000,
				dialogClass: 'fixed-dialog',
				title: 'Image Options',
				open:function(){
					$('#image_connected_to_field').val(form_field_unique_id);				
				}
			});
		});
		return false;
	});

	$('#notifi_without_temp').live('click', function() {

		if($(this).is(':checked')) {
			$('.notification_without_template_div').show();
		}else {
			$('.notification_without_template_div').hide();
		}
	});

	$('#header_width').live('keyup', function() {
		$('.header-image-wrapper img').attr('width', $(this).val());
	});

	$('#header_height').live('keyup', function() {
		$('.header-image-wrapper img').attr('height', $(this).val());
	});

	$('#header_alignment').live('change', function() {
		$('.header_alignment_td').attr('align', $(this).val());
	});

	$('#header_image_name').live('click', function() {
		$('.header_image_name').click();
	});

	$('.header_image_name').live('click', function() {

		var url		= base_path+'form/get_notification_header_image';
		var form_id = $('#form_id').val();

		$.post(url, {form_id : form_id }, function(data) {

			$('#dialog').html(data).dialog({
				modal:true,
				minWidth: 600,
				resizable: false,
				closeOnEscape: true,
				autoResize: false,
				draggable: false,
				zIndex: 12000,
				dialogClass: 'fixed-dialog',
				title: 'Header Image Options',
				open:function(){
//					$('#image_connected_to_field').val(form_field_unique_id);				
				}
			});
		});
		return false;
	});

	$('#footer_width').live('keyup', function() {
		$('.footer-image-wrapper img').attr('width', $(this).val());
	});

	$('#footer_height').live('keyup', function() {
		$('.footer-image-wrapper img').attr('height', $(this).val());
	});

	$('#footer_alignment').live('change', function() {
		$('.footer_alignment_td').attr('align', $(this).val());
	});

	$('#footer_image_name').live('click', function() {
		$('.footer_image_name').click();
	});

	$('.footer_image_name').live('click', function() {

		var url		= base_path+'form/get_notification_footer_image';
		var form_id = $('#form_id').val();

		$.post(url, {form_id : form_id }, function(data) {

			$('#dialog').html(data).dialog({
				modal:true,
				minWidth: 600,
				resizable: false,
				closeOnEscape: true,
				autoResize: false,
				draggable: false,
				zIndex: 12000,
				dialogClass: 'fixed-dialog',
				title: 'Footer Image Options',
				open:function(){
//					$('#image_connected_to_field').val(form_field_unique_id);				
				}
			});
		});
		return false;
	});

	$('.tool-copy').live('click', function(e) {

		e.preventDefault();

		//hide all the pointers if they are visible
		if($('.info-tip').length > 0){
			$('.info-tip').hide();
		}

		$('.tipsy').hide();

		$('#add-remove-field-icon').removeClass('minusIco').addClass('addIco');

		$('#loadedFields').slideUp('fast');

		$('.add_new_fields_info_inside').hide();

		$('.add_new_fields_info').show();

		var id = $(this).parents('.single-field').find('input.ordering').attr('id').split('order-')[1];

		var position = $(this).parents('.single-field').find('input.ordering').val();

		var index = eval(position-1);

		var url = base_path+'form/duplicate_field/';

		$.post(url, {id : id}, function(data) {

			$('#sortable li').each(function(i) {
				$(this).removeClass('super-selected-li');
			});

			$('#sortable li:eq('+index+')').after(data);

			$('#sortable li:eq('+index+')').effect("transfer", { to: $('#sortable li:eq('+eval(index+1)+')') }, 800);
			$('#sortable li:eq('+eval(index+1)+')').addClass('super-selected-li');

			$('#sortable input.ordering').each(function(i) {
				i++;
				$(this).val(i);
			});

			var label_alignment = '';
			$('.label-align').each(function(){
				 if($(this).is(':checked')){
					 label_alignment = $(this).val();
				 }
			});

			//align according to the settings
			set_label_align(label_alignment);
		});
		return false;
	});

	$('.tool-up').live('click', function(e) {

		e.preventDefault();

		//hide all the pointers if they are visible
		if($('.info-tip').length > 0){
			$('.info-tip').hide();
		}

		$('.tipsy').hide();

		$('#add-remove-field-icon').removeClass('minusIco').addClass('addIco');

		$('#loadedFields').slideUp('fast');

		$('.add_new_fields_info_inside').hide();

		$('.add_new_fields_info').show();

		//remove class super-selected-li from all li's
		$('#sortable li').each(function(){
			$(this).removeClass('super-selected-li');
		});

		//give it a class selected
		$('.selected-li').addClass('super-selected-li');

		var current = $('.super-selected-li');

		current.prev().before(current);

		$('#sortable input.ordering').each(function(i) {
			i++;
			$(this).val(i);
		});

		$('.properties-table').each(function() {
			$(this).hide();
		});
		return false;
	});

	$('.tool-down').live('click', function(e) {

		e.preventDefault();

		//hide all the pointers if they are visible
		if($('.info-tip').length > 0){
			$('.info-tip').hide();
		}

		$('.tipsy').hide();

		$('#add-remove-field-icon').removeClass('minusIco').addClass('addIco');

		$('#loadedFields').slideUp('fast');

		$('.add_new_fields_info_inside').hide();

		$('.add_new_fields_info').show();

		//remove class super-selected-li from all li's
		$('#sortable li').each(function(){
			$(this).removeClass('super-selected-li');
		});

		//give it a class selected
		$('.selected-li').addClass('super-selected-li');

		var current = $('.super-selected-li');

		current.next().after(current);

		$('#sortable input.ordering').each(function(i){
			i++;
			$(this).val(i);					
		});

		$('.properties-table').each(function(){
			$(this).hide();
		});

		return false;
	});
});

	function checkKey(e) {

		if(e.keyCode == '27') {
		
			if($('#zoom-form').hasClass('zoomed')){
			
				$('#zoom-form').click();
			}
		}
	}

	if($.browser.mozilla) {
		$(document).keypress (checkKey);
	} else {
		$(document).keydown (checkKey);
	}


$(function() {

	var img_url = base_path+'images/calendar.gif';
	var date_format = $(this).parents('.properties-table').find('.field_date_format option:selected').val();
	$(".datepicker").datepicker({
		changeMonth: true,
		changeYear: true,
		dateFormat: date_format,
		showOn: "both",
		buttonImage: img_url,
		buttonImageOnly: true,
		onSelect : function(ui, event){
			$(this).parents('.single-field').find('.date-actual').val(this.value);
		}
	 });
	 
	$(".field_default_date").live('click',function(){
		var date_format = $(this).parents('.properties-table').find('.field_date_format option::selected').val();
		$(this).datepicker({changeMonth: true, changeYear: true, showOn:'focus',dateFormat: date_format,onSelect : function(ui, event){
			$(this).parents('.single-field').find('.date-actual').val(this.value);
		}}).focus();
	});
	
	$(".field_date_format").live('change', function() {
		$(this).parents('.properties-table').find('.field_default_date').datepicker( "option", "dateFormat", $( this ).val());
		var changed_date = $(this).parents('.properties-table').find('.field_default_date').val();
		$(this).parents('.single-field').find('.date-actual').val(changed_date);
	});
});


/*-------------------UP/DOWN arrow code end-----------------------*/


/*-------------------Form Settings JS-----------------------*/
	$('.form-settings-submission-data-form_field_checkbox').live('click', function() {

		var all_checkbox_length =	$('#form-settings-submission-data-checkbox').find('input').length;

		var count = 0;
		$('#form-settings-submission-data-checkbox').find('input').each(function() {
			if($(this).is(':checked')) {
				count++;
			}
		});

		if(all_checkbox_length == count) {
			$('#form-settings-submission-data-2-check').attr('checked', 'checked');
		}else {
			$('#form-settings-submission-data-2-check').removeAttr('checked');		
		}
	});

/*
	$('.form-settings-amount-field-form_field_checkbox').live('click', function() {

		var all_checkbox_length =	$('#form-settings-amount-fields-checkbox').find('input').length;

		var count = 0;
		$('#form-settings-amount-fields-checkbox').find('input').each(function() {
			if($(this).is(':checked')) {
				count++;
			}
		});

		if(all_checkbox_length == count) {
			$('#form-settings-amount-fields-2-check').attr('checked', 'checked');
		}else {
			$('#form-settings-amount-fields-2-check').removeAttr('checked');		
		}
	});
*/

	$('#custom_amount_check').live('click', function() {

		if($(this).is(':checked')) {

			add_custom_amount_field('Tag17','17');

		}else {

			var form_field_unique_id = $(this).attr('rel');
			var form_id				 = $('#form_id').val();

			if(form_field_unique_id != '' && form_id != '') {

				var url = base_path+'form/delete_amount_form_field';

				$('.main-loader').slideDown("slow");

				$.post( url, { form_id : form_id, form_field_unique_id : form_field_unique_id }, function(data) {

					$('.main-loader').slideUp("slow");

					$('#custom_amount_message').removeClass('custom_amount_add');
					$('#custom_amount_message').addClass('custom_amount_delete');

					$('#custom_amount_message').html('Your Donation/Custom amount field has been deleted from your form successfully.').show();

					save_payment_settings();
				});
			}else {
				alert('Something went wrong please contact at support@form2pay.com');
			}
		}
	});

	$('.form_settings_other_amount_form_field_checkbox').live('click', function() {

		var all_checkbox_length = $('#other_payment_fields_all_check_div ul li .form_settings_other_amount_form_field_checkbox').length;

		var count = 0;
		$('#other_payment_fields_all_check_div ul li .form_settings_other_amount_form_field_checkbox').each(function() {
			if($(this).is(':checked')) {
				count++;
			}
		});

		if(all_checkbox_length == count) {
			$('#form_settings_other_payment_fields_all_check').attr('checked', 'checked');
		}else {
			$('#form_settings_other_payment_fields_all_check').removeAttr('checked');		
		}

		var form_field_unique_id = $(this).attr('rel');

		var option_form_field_unique_id = 'options_'+form_field_unique_id;

		if($(this).is(':checked')) {

			$('#'+option_form_field_unique_id).show();
/*
			$('html,body').animate({ scrollTop: $("#"+option_form_field_unique_id).offset().top - 80 }, 'slow');

			var animDuration = 2000; //ms of the animation duration
			$('#'+option_form_field_unique_id).addClass("highlight_div");

			setTimeout( function() {
				$('#'+option_form_field_unique_id).removeClass("highlight_div");
			}, animDuration );
*/
		}else {
			$('#'+option_form_field_unique_id).hide();
		}
	});

	colors = new Array('black', 'red', 'green');
	function annoyingEffect(tic, id) {
		tic %= colors.length;
		//document.bgColor = colors[tic];
		$('#'+id).css('background', colors[tic]);

		var tic_add = tic+1;

		setTimeout("annoyingEffect("+(tic_add, id)+")", 2000);
	}

	$('.more_info_data').live('click', function() {

		var all_more_info_checkbox_length =	$('#more_info_about_submission').find('input').length;

		var count = 0;
		$('#more_info_about_submission').find('input').each(function() {
			if($(this).is(':checked')) {
				count++;
			}
		});

		if(all_more_info_checkbox_length == count) {
			$('#more_info').attr('checked', 'checked');
		}else {
			$('#more_info').removeAttr('checked');		
		}

	});

	function getCheckedElem()
	{
		if($('#form-settings-submission-data-2-check').filter(':checked').length > 0) {
			$('.form-settings-submission-data-form_field_checkbox').attr('checked', 'checked');
		}else {
			$('.form-settings-submission-data-form_field_checkbox').removeAttr('checked');
		}
	}

	function getCheckedElem_2()
	{
		if($('#more_info').filter(':checked').length > 0) {
			$('.more_info_data').attr('checked', 'checked');
		}else {
			$('.more_info_data').removeAttr('checked');
		}
	}

	function getCheckedElem_3()
	{
		if($('#form-settings-amount-fields-2-check').filter(':checked').length > 0) {
			$('.form-settings-amount-field-form_field_checkbox').attr('checked', 'checked');
		}else {
			$('.form-settings-amount-field-form_field_checkbox').removeAttr('checked');
		}
	}

	function getCheckedElem_4()
	{
		if($('#form_settings_other_payment_fields_all_check').filter(':checked').length > 0) {

			$('.form_settings_other_amount_form_field_checkbox').each(function() {

				var form_field_unique_id = $(this).attr('rel');

				var option_form_field_unique_id = 'options_'+form_field_unique_id;

				$('#'+option_form_field_unique_id).show();

			});

			$('.form_settings_other_amount_form_field_checkbox').attr('checked', 'checked');
		}else {

			$('.form_settings_other_amount_form_field_checkbox').each(function() {

				var form_field_unique_id = $(this).attr('rel');

				var option_form_field_unique_id = 'options_'+form_field_unique_id;

				$('#'+option_form_field_unique_id).hide();

			});
			$('.form_settings_other_amount_form_field_checkbox').removeAttr('checked');
		}
	}

	function insertAtCaret(area, text) 
	{
		var scrollPos = area.scrollTop;
		var strPos = 0;
		var br = ((area.selectionStart || area.selectionStart == '0') ? "ff" : (document.selection ? "ie" : false ) );
		if (br == "ie") {
			area.focus();
			var range = document.selection.createRange();alert(area);
			range.moveStart ('character', -(area.value.length));
			strPos = range.text.length;
		} else if (br == "ff")
			strPos = area.selectionStart;
		var front = (area.value).substring(0, strPos);  
		var back = (area.value).substring(strPos, area.value.length); 
		area.value=front+text+back;
		strPos = strPos + text.length;
		if (br == "ie") { 
			area.focus();
			var range = document.selection.createRange();
			range.moveStart ('character', -(area.value.length));
			range.moveStart ('character', strPos);
			range.moveEnd ('character', 0);
			range.select();
		} else if (br == "ff") {
			area.selectionStart = strPos;
			area.selectionEnd = strPos;
			area.focus();
		}
		area.scrollTop = scrollPos;
	}


$(document).ready(function() {

	$('.field-preview-div input[type=text], .field-preview-div textarea').each(function(e){
		$(this).attr('disabled', true);
		$(this).css({'background' : 'none', 'border' : '1px solid #7F9DB9', 'padding' : '2px'});
	});

	$('.field-preview-div select').live('click', function(e){
		$(this).blur();
	});

	$('.settings-trigger').click(function(e) {
		if($(".info-tip").length > 0){
			$(".info-tip").remove();
		}
	});

	$('#tool-settings').live('click', function() {

		if($(this).hasClass('general_information_save')) {

			var id		=	$(this).attr('id');
			var form_id	=	$('#form_id').val();
			var url		=	base_path+'form/check_email_notification_enable/';

			$.post(url, { form_id : form_id }, function(data) 
			{
				var	form_name		=  $('#formname').val();
				var	email_address	=  $('.email_address').val();
				var set_captcha		=  ($('#set_captcha').is(':checked')) ? 'yes' : 'no';

				if(form_name == '') {
					$('.error-new-div').html('Enter form name').fadeIn('slow');
					$('#formname').css('border', '1px solid red');
					$('#formname').focus();
					return false;
				}else {
					$('#formname').css('border', '');
				}

				var notification_to = new Array();
				var error =	0;

				if(data == 'yes') {

					if(email_address == '') {

						$('.error-new-div').html('Enter email address').fadeIn('slow');
						$('.email_address').css('border', '1px solid red');
						$('.email_address').focus();
						return false;
					}else {
						$('.email_address').css('border', '');

						var cnt_email	=	0;

						$(".email_address").each(function() {

							if($(this).val() != '') {

								var pattern	= /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/;
								var result	= pattern.test($(this).val());
					
								if(!result) {
									error++;
								}else {
									notification_to[cnt_email]	=	$(this).val();
									cnt_email++;
								}
							}
						});
					}
				}else {

					if(email_address != '') {

						var cnt_email	=	0;
						var error		=	0;

						$(".email_address").each(function() {

							if($(this).val() != '') {

								var pattern	= /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/;
								var result	= pattern.test($(this).val());
					
								if(!result) {
									error++;
								}else {
									notification_to[cnt_email]	=	$(this).val();
									cnt_email++;
								}
							}
						});
					}
				}

				if(error > 0) {
					$('.error-new-div').html('').fadeOut('fast');
					$('.error-new-div').html('Please enter valid email address').fadeIn('fast');
					$('.email_address').css('border', '1px solid red');
					$('.email_address').focus();
					return false;
				}

				var url	= base_path+'form/save_general_information/';

				$('.main-loader').slideDown("slow");
				$('#'+id).find('a').html('Saving...');

				$.post(url, {form_id : form_id, form_name : form_name, notification_to : notification_to, set_captcha : set_captcha}, function(data) 
				{
					$('.main-loader').slideUp("slow");
					$('#'+id).find('a').html('Saved');
					$('#edit-title-h1').html(form_name);
				});
			});
		}else if($(this).hasClass('promotion_settings_save')) {

			if($('#settings-form-limit-results-check').is(':checked')) {

				if($('#settings-form-limit-results').val() == '') {

					$('.error-line').html('Please enter result limits').fadeIn('fast');
					$('#settings-form-limit-results').parent('span').css('border', '1px solid red');
					$('#settings-form-limit-results').focus();
					return false;
				}
			}

			if($('#settings-form-start-date-check').is(':checked')) {

				if($('#settings-form-start-date').val() == '') {

					$('#start_date_error').html('Please select start date').fadeIn('fast');
					$('#settings-form-start-date').parent('span').css('border', '1px solid red');
					$('#settings-form-start-date').focus();
					return false;
				}
			}

			if($('#settings-form-end-date-check').is(':checked')) {

				if($('#settings-form-end-date').val() == '') {

					$('#end_date_error').html('Please select end date').fadeIn('fast');
					$('#settings-form-end-date').parent('span').css('border', '1px solid red');
					$('#settings-form-end-date').focus();
					return false;
				}
			}

			var id = $(this).attr('id');

			var promotion_settings = new Array();

			promotion_settings[0]	=	$('#settings-form-start-date-check').is(':checked') ? 'yes' : 'no';
			promotion_settings[1]	=	$('#settings-form-start-date').val();
			promotion_settings[2]	=	$('#settings-form-start-date-title').val();
			promotion_settings[3]	=	$('#settings-form-start-date-message').val();

			promotion_settings[4]	=	$('#settings-form-end-date-check').is(':checked') ? 'yes' : 'no';
			promotion_settings[5]	=	$('#settings-form-end-date').val();
			promotion_settings[6]	=	$('#settings-form-end-date-title').val();
			promotion_settings[7]	=	$('#settings-form-end-date-message').val();

			promotion_settings[8]	=	$('#settings-form-limit-results-check').is(':checked') ? 'yes' : 'no';
			promotion_settings[9]	=	$('#settings-form-limit-results').val();

			var form_id				=	$('#form_id').val();

			var url = base_path+'form/save_promotion_settings/';

			$('.main-loader').slideDown("slow");

			$('#'+id).find('a').html('Saving...');	

			$.post(url, {form_id : form_id, promotion_settings : promotion_settings}, function(data) {

				$('.main-loader').slideUp("slow");

				$('#'+id).find('a').html('Saved');

			});
		}else if($(this).hasClass('security_settings_save')) {
			
			var id = $(this).attr('id');
		
			var prevent_multiple_check		=	$('#settings-form-prevent-multiple-check').is(':checked')	? 'yes' : 'no';
			var ssl_check					=	$('#settings-form-ssl-check').is(':checked')				? 'yes' : 'no';
			var captcha_check				=	$('#settings-form-captcha-check').is(':checked')			? 'yes' : 'no';
			var captcha_type				=	'';

			$('.captcha_type').each(function(){
				if($(this).is(':checked')){
					captcha_type = $(this).val();			
				}
			});

			var form_id	= $('#form_id').val();

			var url = base_path+'form/save_security_settings/';

			$('.main-loader').slideDown("slow");

			$('#'+id).find('a').html('Saving...');
			
			$.post(url, {form_id : form_id, prevent_multiple_check : prevent_multiple_check, ssl_check : ssl_check, captcha_check : captcha_check, captcha_type : captcha_type}, function(data) {
				$('.main-loader').slideUp("slow");
				$('#'+id).find('a').html('Saved');
			});
		}else if($(this).hasClass('notification_settings_save')) {

			var id = $(this).attr('id');

			var submission_data_type = '';

			var form_settings_notification_to	=	new Array();
			var form_settings_notification_from	=	'';
			var allEmailFieldsValid				=	true;
			var cnt_email						=	0;
			var error							=	0;

			if($('#form-settings-notification-check').is(':checked')) {

				$(".form-settings-notification-to").each(function() {

					if($(this).val() != '') {

						var pattern	= /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/;
						var result	= pattern.test($(this).val());
		
						if(!result) {
							error++;
						}else {
							form_settings_notification_to[cnt_email]	=	$(this).val();
							cnt_email++;
						}
					}
				});

				if(error > 0) {
					$('.error-line').html('').fadeOut('fast');
					$('.error-line').html('Please enter valid email').fadeIn('fast');
					$('.form-settings-notification-to').css('border', '1px solid red');
					$('.form-settings-notification-to').focus();
					return false;
				}

				var from =	'';

				if(from != '') {

					var pattern	= /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/;
					var result	= pattern.test(from);
		
					if(!result) {
						$('.error-line').html('').fadeOut('fast');
						$('.form-settings-notification-to').css('border', '');
						$('.error-line-2').html('Please enter valid email').fadeIn('fast');
						$('#form-settings-notification-from').css('border', '1px solid red');
						$('#form-settings-notification-from').focus();
						return false;
					}else {
						var form_settings_notification_from	= from;
					}
				}
			}

			var form_settings_notification_check		=	$('#form-settings-notification-check').is(':checked') ? 'yes' : 'no';

			var from_user_email_check					=	$('#from-user-email-check').is(':checked') ? 'yes' : 'no';

			var user_email_address						=	$('#user_email_address').val();

			var form_settings_notification_from_name	=	$('#form-settings-notification-from-name').val();

			if(form_settings_notification_from_name != '') {

				var regex = new RegExp("^[a-zA-Z0-9 ]+$");
				if(!regex.test(form_settings_notification_from_name)) {
					$('.error-line-2').html('Please enter alpha numeric characters only').fadeIn('fast');
					$('#form-settings-notification-from-name').css('border', '1px solid red');
					$('#form-settings-notification-from-name').focus();
					return false;
				}
			}

			var form_settings_notification_subject		=	$('#form-settings-notification-subject').val();
			
			var form_settings_submission_data_check		=	$('#form-settings-submission-data-check').is(':checked') ? 'yes' : 'no';
			var form_settings_submission_data_2_check	=	$('#form-settings-submission-data-2-check').is(':checked') ? 'yes' : 'no';

			var form_settings_submission_msg			=	$('#form-settings-submission-msg').val();
			var form_settings_submission_msg_line		=	$('#form-settings-submission-msg-line').val();

			var notifi_without_FormName					=	$('#notifi_without_FormName').is(':checked') ? 1 : 0;

			var notifi_without_temp						=	$('#notifi_without_temp').is(':checked') ? 1 : 0;

			var header_image_name	= '';
			var header_width		= '';
			var header_height		= '';
			var header_alignment	= '';

			var footer_image_name	= '';
			var footer_width		= '';
			var footer_height		= '';
			var footer_alignment	= '';

			if(notifi_without_temp == 1) {
				header_image_name	= $('#header_image_name').val();
				header_width		= $('#header_width').val();
				header_height		= $('#header_height').val();
				header_alignment	= $('#header_alignment').val();

				footer_image_name	= $('#footer_image_name').val();
				footer_width		= $('#footer_width').val();
				footer_height		= $('#footer_height').val();
				footer_alignment	= $('#footer_alignment').val();
			}

			//---------------------- var optionTexts = [];
			var notification_fields_values = [];
			$('#form-settings-submission-data-checkbox').find('input').each(function() {
				if($(this).is(':checked')){
					notification_fields_values.push($(this).attr('id'));
				}
			});
			//-------------------------------------------------------------------------------

			//---------------------- var more_info_optionTexts = [];
			var more_info	=	$('#more_info').is(':checked') ? 'yes' : 'no';

			var more_info_notification = [];
			$('#more_info_about_submission').find('input').each(function() {
				if($(this).is(':checked')){
					more_info_notification.push($(this).attr('id'));
				}
			});
			//-------------------------------------------------------------------------------

			$('.submission-data-type').each(function() {
				if($(this).is(':checked')) {
					submission_data_type = $(this).val();			
				}
			});

			var form_id	=  $('#form_id').val();

			var url = base_path+'form/save_notification_settings/';

			$('.main-loader').slideDown("slow");

			$('#'+id).find('a').html('Saving...');

			$.post(url, 
				{form_id : form_id, 
				form_settings_notification_check		: form_settings_notification_check, 
				form_settings_notification_to			: form_settings_notification_to, 
				from_user_email_check					: from_user_email_check, 
				user_email_address						: user_email_address, 
				form_settings_notification_from			: form_settings_notification_from,
				form_settings_notification_from_name	: form_settings_notification_from_name,
				form_settings_notification_subject		: form_settings_notification_subject,
				form_settings_submission_data_check		: form_settings_submission_data_check, 
				form_settings_submission_data_2_check	: form_settings_submission_data_2_check, 
				form_settings_submission_msg			: form_settings_submission_msg, 
				form_settings_submission_msg_line		: form_settings_submission_msg_line, 
				submission_data_type					: submission_data_type,
				notification_fields_values				: notification_fields_values,
				more_info								: more_info,
				more_info_notification					: more_info_notification,
				notifi_without_FormName					: notifi_without_FormName,
				notifi_without_temp						: notifi_without_temp,
				header_image_name						: header_image_name,
				header_width							: header_width,
				header_height							: header_height,
				header_alignment						: header_alignment,
				footer_image_name						: footer_image_name,
				footer_width							: footer_width,
				footer_height							: footer_height,
				footer_alignment						: footer_alignment
				},
				function(data) {
		
					$('.main-loader').slideUp("slow");
					$('#'+id).find('a').html('Saved');
			});

		}else if($(this).hasClass('sms_notification_settings_save')) {

			var id = $(this).attr('id');

			var sms_notification_to_country_code	=	new Array();
			var sms_notification_to					=	new Array();
			var cnt_sms								=	0;
			var cnt_country_code					=	0;
			var error								=	0;
			var error2								=	0;

			if($('#form-settings-sms-check').is(':checked')) {

				$(".form-settings-sms-notification-to").each(function() {

					if($(this).val() != '') {

						var filter  = /^[0-9-+]+$/;
						var result	= filter.test($(this).val());
		
						if(!result) {
							$(this).parents('span.new_sms').find('.form-settings-sms-notification-to').css('border', '1px solid red');
							$(this).parents('span.new_sms').find('.error-line').html('Please enter valid phone number').show();
							error++;
							return false;
						}else {
							$('.form-settings-sms-notification-to').css('border', '');
							$(this).parents('span.new_sms').find('.error-line').html('').hide();
							sms_notification_to[cnt_sms] = $(this).val();
							cnt_sms++;
						}
					}
				});

				if(error > 0) {
					$('.error-line').html('').fadeOut('fast');
//					$('.error-line').html('Please enter valid phone number').fadeIn('fast');
//					$('.form-settings-sms-notification-to').css('border', '1px solid red');
//					$('.form-settings-sms-notification-to').focus();
					return false;
				}

				$(".country_code").each(function() {

					var country_code = $(this).val();

					if(country_code == -1) {
						$(this).parents('span.new_sms').find('.error-line').html('Select the country code to get the SMS Notification').show();
						error2++;
						return false;
					}else {
						var mob_number = $(this).parents('span.new_sms').find('.form-settings-sms-notification-to').val();
						$(this).parents('span.new_sms').find('.error-line').html('').hide();
						sms_notification_to_country_code[cnt_country_code] = country_code+'~'+mob_number;
						cnt_country_code++;
					}
				});

				if(error2 > 0) {
//					$('.error-line').html('').fadeOut('fast');
//					$('.error-line').html('Select the country code to get the SMS Notification').fadeIn('fast');
					return false;
				}

				if(sms_notification_to == '') {
					$('.error-line').html('').fadeOut('fast');
					$('.error-line').html('Please enter your phone number').fadeIn('fast');
					$('.form-settings-sms-notification-to').css('border', '1px solid red');
					$('.form-settings-sms-notification-to').focus();
					return false;					
				}
			}

			var form_settings_sms_check	=	$('#form-settings-sms-check').is(':checked') ? 'yes' : 'no';
			var timezone				=	$('#DropDownTimezone').val();
			var at_any_time				=	$('#at_any_time').is(':checked') ? 'yes' : 'no';
			var desired_time			=	$('#desired_time').is(':checked') ? 'yes' : 'no';
			var from_time				=	$('#from_time').val();
			var to_time					=	$('#to_time').val();
			var submission_link_check	=	$('#submission_link').is(':checked') ? 'yes' : 'no';
			var customize_data_check	=	$('#customize_data').is(':checked') ? 'yes' : 'no';
			var submission_msg			=	$('#form-settings-submission-msg').val();
			var submission_data_check	=	$('#form-settings-submission-data-check').is(':checked') ? 'yes' : 'no';
			var submission_data_2_check	=	$('#form-settings-submission-data-2-check').is(':checked') ? 'yes' : 'no';
			var field_label				=	$('#field_label').is(':checked') ? 'yes' : 'no';

			//---------------------- var optionTexts = [];
			var notification_fields_values = [];
			$('#form-settings-submission-data-checkbox').find('input').each(function() {
				if($(this).is(':checked')){
					notification_fields_values.push($(this).attr('id'));
				}
			});
			//-------------------------------------------------------------------------------

			var form_id	=  $('#form_id').val();

			var url = base_path+'form/save_sms_notification_settings/';

			$('.main-loader').slideDown("slow");

			$('#'+id).find('a').html('Saving...');

			$.post(url, {
				form_id							 : form_id, 
				form_settings_sms_check			 : form_settings_sms_check, 
				sms_notification_to_country_code : sms_notification_to_country_code, 
				sms_notification_to				 : sms_notification_to, 
				timezone						 : timezone,
				at_any_time						 : at_any_time,
				desired_time					 : desired_time,
				from_time						 : from_time,
				to_time							 : to_time,
				submission_link_check			 : submission_link_check,
				customize_data_check			 : customize_data_check,
				submission_msg					 : submission_msg, 
				submission_data_check			 : submission_data_check, 
				submission_data_2_check			 : submission_data_2_check, 
				notification_fields_values		 : notification_fields_values,
				field_label						 : field_label
				}, function(data) {
		
					$('.main-loader').slideUp("slow");
					$('#'+id).find('a').html('Saved');
			});
		}else if($(this).hasClass('save_warning_messages')) {

			var form_id = $('#form_id').val();
			var warning_messages_form = $('#warning_messages_form').serialize();
			var url = base_path+'form/save_warning_messages/'+form_id;

			$('.main-loader').slideDown("slow");
			$('#'+id).find('a').html('Saving...');
			
			$.post(url, { form_id : form_id, warning_messages_form : warning_messages_form }, function(data) {

				$('.main-loader').slideUp("slow");

				if(data == 'affected') {
					$('.success').fadeIn();
					$('#'+id).find('a').html('Saved');
				}else if(data == 'not') {
					$('.failure').fadeIn('slow');
				}else {
					$("#dialog").dialog("close");
				}
			});

		}else if($(this).hasClass('auto_responder_settings_save')) {

			var form_settings_autoresponder_from	= '';
			var form_settings_autoresponder_subject = '';

			if($('#form-settings-autoresponder-check').is(':checked')) {

				var from = $('#form-settings-autoresponder-from').val();

				if(from == '') {
					$('.error-line').html('').fadeOut('fast');
					$('.error-line').html('Please enter from email-id').fadeIn('fast');
					$('#form-settings-autoresponder-from').css('border', '1px solid red');
					$('#form-settings-autoresponder-from').focus();
					return false;
				}else {

					var pattern	= /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/;
					var result	= pattern.test(from);
		
					if(!result) {
						$('.error-line').html('').fadeOut('fast');
						$('.error-line').html('Please enter valid email').fadeIn('fast');
						$('#form-settings-autoresponder-from').css('border', '1px solid red');
						$('#form-settings-autoresponder-from').focus();
						return false;
					}else{
						form_settings_autoresponder_from = from;
					}
				}

				var subject	= $('#form-settings-autoresponder-subject').val();

				if(subject == '')
				{
					$('.error-line').html('').fadeOut('fast');
					$('.error-line-2').html('Please enter subject').fadeIn('fast');
					$('#form-settings-autoresponder-from').css('border', '');
					$('#form-settings-autoresponder-subject').css('border', '1px solid red');
					$('#form-settings-autoresponder-subject').focus();
					return false;
				}else {
					form_settings_autoresponder_subject	= subject;
				}
			}

			var id = $(this).attr('id');

			var form_settings_autoresponder_check	=	$('#form-settings-autoresponder-check').is(':checked') ? 'yes' : 'no';
			var user_email_address					=	$('#user_email_address').val();
			var form_settings_autoresponder_name	=	$('#form-settings-autoresponder-name').val();
			var form_settings_autoresponder_msg		=	$('#form-settings-autoresponder-msg').val();
			var form_id								=	$('#form_id').val();

			var url = base_path+'form/save_autoresponder_settings/';

			$('.main-loader').slideDown("slow");

			$('#'+id).find('a').html('Saving...');

			$.post(
				url, 
				{form_id : form_id, 
				form_settings_autoresponder_check	: form_settings_autoresponder_check, 
				user_email_address					: user_email_address, 
				form_settings_autoresponder_name	: form_settings_autoresponder_name,
				form_settings_autoresponder_from	: form_settings_autoresponder_from, 
				form_settings_autoresponder_subject : form_settings_autoresponder_subject, 
				form_settings_autoresponder_msg		: form_settings_autoresponder_msg
				},				 
				function(data) {
		
					$('.main-loader').slideUp("slow");
					$('#'+id).find('a').html('Saved');				
			});

		}else if($(this).hasClass('payment_settings_save')) {

			var id = $(this).attr('id');

			var form_settings_payment_check			=	$('#form-settings-payment-check').is(':checked') ? 'yes' : 'no';

			var merchant_type						=	$('#merchant_type').val();

			var payment_paypal_email				=	$('#payment_paypal_email').val();
			var payment_paypal_language				=	$('#payment_paypal_language').val();
			var payment_paypal_currency				=	$('#payment_paypal_currency').val();

			var payment_two_co_number				=	$('#payment_two_co_number').val();
			var payment_two_co_currency				=	$('#payment_two_co_currency').val();
			var payment_two_co_language				=	$('#payment_two_co_language').val();

			var payment_paypal_pro_username			=	$('#payment_paypal_pro_username').val();
			var payment_paypal_pro_password			=	$('#payment_paypal_pro_password').val();
			var payment_paypal_pro_signature		=	$('#payment_paypal_pro_signature').val();
			var payment_paypal_pro_currency			=	$('#payment_paypal_pro_currency').val();

			var payment_authorize_login_id			=	$('#payment_authorize_login_id').val();
			var payment_authorize_transaction_key	=	$('#payment_authorize_transaction_key').val();
			var	payment_authorize_currency			=	$('#payment_authorize_currency').val();

			var sandbox_mode						=	$('#sandbox_mode').is(':checked') ? 'yes' : 'no';

			var pre_determined_amount_label			=	$('#pre_determined_amount_label').val();
			var pre_determined_amount				=	$('#pre_determined_amount').val();

			var custom_amount_check					=	$('#custom_amount_check').is(':checked') ? 'yes' : 'no';
//			var custom_amount_field_unique_value	=	$('#custom_amount_check').attr('rel');

/*
			var form_settings_amount_fields_2_check	=	$('#form-settings-amount-fields-2-check').is(':checked') ? 'yes' : 'no';

			var payment_fields_values = [];
			$('#form-settings-amount-fields-checkbox').find('input').each(function() {
				if($(this).is(':checked')){
					payment_fields_values.push($(this).attr('id'));
				}
			});

*/
			var custom_amount_field_unique_value = [];
			$('#custom_amount_field_checkbox').find('input').each(function() {
				if($(this).is(':checked')) {
					custom_amount_field_unique_value.push($(this).attr('rel'));
				}
			});

			var form_settings_other_payment_fields_all_check = $('#form_settings_other_payment_fields_all_check').is(':checked') ? 'yes' : 'no';

			var other_payment_fields_values = [];
			$('#other_payment_fields_all_check_div ul li .form_settings_other_amount_form_field_checkbox').each(function() {
				if($(this).is(':checked')) {
					other_payment_fields_values.push($(this).attr('id'));
				}
			});

			var other_payment_fields_option_values = [];
			$('.option_values').each(function() {
				obj = {};
				var this_field_unique_id = $(this).attr('id');
				var this_field_option_id = $(this).attr('rel');
				var this_fields_value	 = $(this).val();

				obj[this_field_unique_id] = this_fields_value;
				other_payment_fields_option_values.push(obj); 
			});

			var show_running_total			=	$('#show_running_total').is(':checked')			? 'yes' : 'no';
			var collect_shipping_address	=	$('#collect_shipping_address').is(':checked')	? 'yes' : 'no';
			var recurring_billing			=	$('#recurring_billing').is(':checked')			? 'yes' : 'no';
			
			var recurring_period		= '';
			var recurring_period_type	= '';
			if(recurring_billing == 'yes') {
				recurring_period			=	$('#recurring_period').val();
				recurring_period_type		=	$('#recurring_period_type').val();
			}

			var form_id	=  $('#form_id').val();

			var url = base_path+'form/save_payment_settings/';

			$('.main-loader').slideDown("slow");

			$('#'+id).find('a').html('Saving...');

			$.post(url, 
				{form_id : form_id, 
				form_settings_payment_check						: form_settings_payment_check, 
				form_settings_other_payment_fields_all_check	: form_settings_other_payment_fields_all_check, 
				other_payment_fields_values						: other_payment_fields_values, 
				other_payment_fields_option_values				: other_payment_fields_option_values, 
				merchant_type									: merchant_type, 
				payment_paypal_email							: payment_paypal_email, 
				payment_paypal_language							: payment_paypal_language, 
				payment_paypal_currency							: payment_paypal_currency,
				payment_two_co_number							: payment_two_co_number,
				payment_two_co_currency							: payment_two_co_currency,
				payment_two_co_language							: payment_two_co_language,
				payment_paypal_pro_username						: payment_paypal_pro_username,
				payment_paypal_pro_password						: payment_paypal_pro_password,
				payment_paypal_pro_signature					: payment_paypal_pro_signature,
				payment_paypal_pro_currency						: payment_paypal_pro_currency,
				payment_authorize_login_id						: payment_authorize_login_id,
				payment_authorize_transaction_key				: payment_authorize_transaction_key,
				payment_authorize_currency						: payment_authorize_currency,
				sandbox_mode									: sandbox_mode,
				pre_determined_amount_label						: pre_determined_amount_label,
				pre_determined_amount							: pre_determined_amount,
				custom_amount_check								: custom_amount_check,
				custom_amount_field_unique_value				: custom_amount_field_unique_value,
//				form_settings_amount_fields_2_check				: form_settings_amount_fields_2_check,
//				payment_fields_values							: payment_fields_values,
				show_running_total								: show_running_total,
				collect_shipping_address						: collect_shipping_address,
				recurring_billing								: recurring_billing,
				recurring_period								: recurring_period,
				recurring_period_type							: recurring_period_type
				},
				function(data) {
		
					$('.main-loader').slideUp("slow");
					$('#'+id).find('a').html('Saved');
			});

		}else if($(this).hasClass('success_page_settings_save')) {

			var form_id	 =  $('#form_id').val();
			var id		 =	$(this).attr('id');
			var href	 =	$(this).find('a').attr('href'); 

			var page_style = '';
			$('.page-style').each(function(){
				if($(this).is(':checked')){
					page_style = $(this).val();
				}
			});

			if(page_style == 'standard') {

				var form_settings_success_page_body  =	$('#form-settings-success-page-body').val();
				
				var form_settings_success_page_redirect_url = '';
				var url_email_id = '';

				var url = base_path+'form/save_successpage_settings/';

				$('.main-loader').slideDown("slow");

				$('#'+id).find('a').html('Saving...');

				$.post(
					url, 
					{ form_id : form_id, form_settings_success_page_body : form_settings_success_page_body, form_settings_success_page_redirect_url : form_settings_success_page_redirect_url, page_style : page_style, url_email_id : url_email_id },
					function(data) {
						$('.main-loader').slideUp("slow");
						$('#'+id).find('a').html('Saved');
				});
			}else if($(this).hasClass('success_page_settings_save')) {

				var form_settings_success_page_body  =	'';
				
				var redirect_url = '';
				$('.redirect-url').each(function(){
					redirect_url += $(this).val();
				});

				if(redirect_url == 'http://')
				{
					$('.error-line').html('').fadeOut('fast');
					$('.error-line').html('Please enter redirect URL').fadeIn('fast');
					$('.redirect-url').parent('span').css('border', '');
					$('.redirect-url-2').parent('span').css('border', '1px solid red');
					$('.redirect-url-2').focus();
					return false;
				}else {
					var pattern = /^(http\:\/\/|https\:\/\/)[A-Za-z0-9_-]+\.+[A-Za-z0-9.\/%&=\?_:;-]+$/;
//					var pattern	= new RegExp("^(http:\/\/www.|https:\/\/www.|ftp:\/\/www.|www.){1}([0-9A-Za-z]+\.)");
					var result	= pattern.test(redirect_url);

					if(!result) {
						$('.error-line').html('').fadeOut('fast');
						$('.error-line').html('Please enter valid URL').fadeIn('fast');
						$('.redirect-url').parent('span').css('border', '');
						$('.redirect-url-2').parent('span').css('border', '1px solid red');
						$('.redirect-url-2').focus();
						return false;
					}else {
						var form_settings_success_page_redirect_url	= redirect_url;

						var splitted_url		=	form_settings_success_page_redirect_url.split(/\./);
//						var splitted_url		=	form_settings_success_page_redirect_url.split('www.');

						var splitted_url_again	=	splitted_url[1].split('.');
						
						var user_domain_name	=	splitted_url_again[0];
					}
				}

				var email_id = $('#form-settings-success-page-email-id').val();

				if(email_id == '') {
					$('.error-line').html('').fadeOut('fast');
					$('.redirect-url').parent('span').css('border', '');
					$('.error-line-2').html('Please enter your domain email-id').fadeIn('fast');
					$('#form-settings-success-page-email-id').parent('span').css('border', '1px solid red');
					$('#form-settings-success-page-email-id').focus();
					return false;
				}else {
					var pattern	= /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/;
					var result	= pattern.test(email_id);
		
					if(!result) {

						$('.error-line').html('').fadeOut('fast');
						$('.redirect-url').parent('span').css('border', '');
						$('.error-line-2').html('Please enter valid email').fadeIn('fast');
						$('#form-settings-success-page-email-id').parent('span').css('border', '1px solid red');
						$('#form-settings-success-page-email-id').focus();
						return false;
					}else {
						url_email_id =	email_id;

						var splitted_email_id		= url_email_id.split('@');

						var splitted_email_id_again	= splitted_email_id[1].split('.');

						var email_id_domain_name	= splitted_email_id_again[0];
					}
				}

				if(email_id_domain_name == user_domain_name) {

					$('#hide_email_id_fields').hide();

					$('#'+id).find('a').html('Saved');

					window.location	= href;

					return false;
				}else {
					
					$('#hide_email_id_fields').show();

					$('.main-loader').slideDown("slow");

					var url = base_path+'form/save_successpage_settings/';

					$.post(
						url, 
						{ form_id : form_id, form_settings_success_page_body : form_settings_success_page_body, form_settings_success_page_redirect_url : form_settings_success_page_redirect_url, page_style : page_style, url_email_id : url_email_id },
						function(data) {
							$('.main-loader').slideUp("slow");
					});

					return false;
				}
			}
		}else {
			return false;
		}
	});

	$('#form-overlay, .settings-close, .close-settings').live('click',function() 
	{
		$('#form-settings-div').fadeOut('fast',function() {

			$('#form-overlay').fadeOut("fast");
			$('#form-settings-div').html('');
			$('#form-settings-div').remove();
		});
	});

	//saving GENERAL INFORMATION
	$('.save-general-information').live('click', function() {

		var id		= $(this).attr('id');
		var form_id	= $('#form_id').val();
		var url		= base_path+'form/check_email_notification_enable/';

		var	form_name		=	$('#formname').val();
		var	email_address	=	$('.email_address').val();

		if($.trim(form_name) == '') {
			$('.error-new-div').html('Enter form name').fadeIn('slow');
			$('#formname').css('border', '1px solid red');
			$('#formname').focus();
			return false;
		}else {
			$('#formname').css('border', '');
		}

		$.post(url, { form_id : form_id }, function(data) 
		{
			var	form_name		=	$('#formname').val();
			var	email_address	=	$('.email_address').val();
			var set_captcha		=	($('#set_captcha').is(':checked')) ? 'yes' : 'no';

			if($.trim(form_name) == '') {
				$('.error-new-div').html('Enter form name').fadeIn('slow');
				$('#formname').css('border', '1px solid red');
				$('#formname').focus();
				return false;
			}else {
				$('#formname').css('border', '');
			}

			if($.trim(email_address) == '') {
				$('.error-new-div').html('Enter email address').fadeIn('slow');
				$('.email_address').css('border', '1px solid red');
				$('.email_address').focus();
				return false;
			}else {
				$('.email_address').css('border', '');
			}

			var notification_to	=	new Array();
			var error =	0;

			if(data == 'yes') {

				if(email_address == '') {
					$('.error-new-div').html('Enter email address').fadeIn('slow');
					$('.email_address').css('border', '1px solid red');
					$('.email_address').focus();
					return false;
				}else {
					$('.email_address').css('border', '');

					var cnt_email			=	0;

					$(".email_address").each(function() {

						if($(this).val() != '') {

							var pattern	= /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/;
							var result	= pattern.test($(this).val());
				
							if(!result) {
								error++;
							}else {
								notification_to[cnt_email]	=	$(this).val();
								cnt_email++;
							}
						}
					});
				}
			}else {
			
				if(email_address != '') {

					var cnt_email	=	0;

					$(".email_address").each(function() {

						if($(this).val() != '') {

							var pattern	= /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/;
							var result	= pattern.test($(this).val());
				
							if(!result) {
								error++;
							}else {
								notification_to[cnt_email]	=	$(this).val();
								cnt_email++;
							}
						}
					});
				}
			}

			if(error > 0) {
				$('.error-new-div').html('').fadeOut('fast');
				$('.error-new-div').html('Please enter valid email address').fadeIn('fast');
				$('.email_address').css('border', '1px solid red');
				$('.email_address').focus();
				return false;
			}

			var url	= base_path+'form/save_general_information/';

			$('.main-loader').slideDown("slow");
			$('#'+id).find('a').html('Saving...');

			$.post(url, {form_id : form_id, form_name : form_name, notification_to : notification_to, set_captcha : set_captcha}, function(data) 
			{
				$('#'+id).find('a').html('Saved');

				$('.main-loader').slideUp("slow", function() {

					if(id == 'save-general-information') {
						window.location = base_path+'form/editform/'+form_id
					}else {
						$('#form-overlay').click();
					}
				});
			});
		});
	});


	// Back to form settings
	$('.back-to-form-settings').live('click', function()
	{
		var id = $(this).attr('id');

		if(id == 'back-to-form-settings') {

			$('#form-settings').click();

		}else {

			$('#form-overlay').click();
		}
	});


	$('#back_to_get_code').live('click', function() {

		if($('#settings-form-limit-results-check').is(':checked')) {

			if($('#settings-form-limit-results').val() == '') {

				$('.error-line').html('Please enter result limits').fadeIn('fast');
				$('#settings-form-limit-results').parent('span').css('border', '1px solid red');
				$('#settings-form-limit-results').focus();
				return false;
			}
		}

		var id = $(this).attr('id');

		var promotion_settings = new Array();
	
		promotion_settings[0]	=	$('#settings-form-start-date-check').is(':checked') ? 'yes' : 'no';
		promotion_settings[1]	=	$('#settings-form-start-date').val();
		promotion_settings[2]	=	$('#settings-form-start-date-title').val();
		promotion_settings[3]	=	$('#settings-form-start-date-message').val();
	
		promotion_settings[4]	=	$('#settings-form-end-date-check').is(':checked') ? 'yes' : 'no';
		promotion_settings[5]	=	$('#settings-form-end-date').val();
		promotion_settings[6]	=	$('#settings-form-end-date-title').val();
		promotion_settings[7]	=	$('#settings-form-end-date-message').val();

		promotion_settings[8]	=	$('#settings-form-limit-results-check').is(':checked') ? 'yes' : 'no';
		promotion_settings[9]	=	$('#settings-form-limit-results').val();

		var form_id				=	$('#form_id').val();

		var url = base_path+'form/save_promotion_settings/';

		$('#'+id).find('a').html('Saving...');	

		$.post(url, {form_id : form_id, promotion_settings : promotion_settings}, function(data) {

			$('#'+id).find('a').html('Saved');				

			window.location = base_path+'publish/options/'+form_id;
		});
	});

	//PROMOTION settings save
	$('.save-promotion-settings').live('click', function() {

		if($('#settings-form-limit-results-check').is(':checked')) {

			if($('#settings-form-limit-results').val() == '') {

				$('.error-line').html('Please enter result limits').fadeIn('fast');
				$('#settings-form-limit-results').parent('span').css('border', '1px solid red');
				$('#settings-form-limit-results').focus();
				return false;
			}
		}

		if($('#settings-form-start-date-check').is(':checked')) {

			if($('#settings-form-start-date').val() == '') {

				$('#start_date_error').html('Please select start date').fadeIn('fast');
				$('#settings-form-start-date').parent('span').css('border', '1px solid red');
				$('#settings-form-start-date').focus();
				return false;
			}
		}

		if($('#settings-form-end-date-check').is(':checked')) {

			if($('#settings-form-end-date').val() == '') {

				$('#end_date_error').html('Please select end date').fadeIn('fast');
				$('#settings-form-end-date').parent('span').css('border', '1px solid red');
				$('#settings-form-end-date').focus();
				return false;
			}
		}

		var id = $(this).attr('id');

		var promotion_settings = new Array();
	
		promotion_settings[0]	=	$('#settings-form-start-date-check').is(':checked') ? 'yes' : 'no';
		promotion_settings[1]	=	$('#settings-form-start-date').val();
		promotion_settings[2]	=	$('#settings-form-start-date-title').val();
		promotion_settings[3]	=	$('#settings-form-start-date-message').val();
	
		promotion_settings[4]	=	$('#settings-form-end-date-check').is(':checked') ? 'yes' : 'no';
		promotion_settings[5]	=	$('#settings-form-end-date').val();
		promotion_settings[6]	=	$('#settings-form-end-date-title').val();
		promotion_settings[7]	=	$('#settings-form-end-date-message').val();

		promotion_settings[8]	=	$('#settings-form-limit-results-check').is(':checked') ? 'yes' : 'no';
		promotion_settings[9]	=	$('#settings-form-limit-results').val();

		var form_id				=	$('#form_id').val();

		var url = base_path+'form/save_promotion_settings/';

		$('#'+id).find('a').html('Saving...');	

		$.post(url, {form_id : form_id, promotion_settings : promotion_settings}, function(data) {

			$('#'+id).find('a').html('Saved');				

			if(id == 'save-promotion-settings-back') {
				window.location = base_path+'form/styling/'+form_id;
			}else if(id == 'save-promotion-settings-next') {
				window.location.hash = 'show-security-settings';
			}else {
				$('#form-overlay').click();
			}
		});
	});

	//SECURITY settings save
	$('.save-security-settings').live('click', function() {
		
		var id = $(this).attr('id');
	
		var prevent_multiple_check		=		$('#settings-form-prevent-multiple-check').is(':checked') ? 'yes' : 'no';
		var ssl_check					=		$('#settings-form-ssl-check').is(':checked') ? 'yes' : 'no';
		var captcha_check				=		$('#settings-form-captcha-check').is(':checked') ? 'yes' : 'no';

		var captcha_type	=	'';
		$('.captcha_type').each(function(){
			if($(this).is(':checked')){
				captcha_type = $(this).val();			
			}
		});

		var form_id				=  $('#form_id').val();

		var url = base_path+'form/save_security_settings/';

		$('#'+id).find('a').html('Saving...');
		
		$.post(
			url, 
			{form_id : form_id, 
			prevent_multiple_check : prevent_multiple_check, 
			ssl_check : ssl_check,
			captcha_check : captcha_check, 
			captcha_type : captcha_type},				 
			function(data){

			$('#'+id).find('a').html('Saved');

			if(id == 'save-security-settings-next') {

				window.location.hash = 'show-notification-settings';
			}else if(id == 'save-security-settings-back') {
				window.location.hash = 'show-promotion-settings';
			}else {

				$('#form-overlay').click();
			}
		});

	});

	$('#add_email_address').live('click', function()
	{
		$(this).parent('div#email_field').after('<div class="email_container"><span class="fltlft" style="position:relative;"><input type="text" name="email_address[]" class="email_address fltlft vtip-south-focus" value="" vtip-title="Enter email address to receive notification"/><a href="#" id="remove_email">Remove</a></span></div>');
		$('#email_field').append('<div class="email_container"><span class="fltlft" style="position:relative;"><input type="text" name="email_address[]" class="email_address fltlft vtip-south-focus" value="" vtip-title="Enter email address to receive notification"/><a href="#" id="remove_email_field">Remove</a></span></div>');
		return false;
	});


	$('#add_another_number').live('click', function()
	{
		var template = '';
		template += '<div class="sms_container">';
		template +=		'<span class="fltlft new_sms" style="position:relative;margin-top:5px;">';
		template +=		'<select style="width:140px;height:26px;margin-right:10px;" class="country_code fltlft" name="country_code"><option value="-1">Select</option><option value="+93">Afghanistan	 (+93)</option><option value="+355">Albania	 (+355)</option><option value="+213">Algeria	 (+213)</option><option value="+1-684">American Samoa	 (+1-684)</option><option value="+376">Andorra	 (+376)</option><option value="+244">Angola	 (+244)</option><option value="+1-264">Anguilla	 (+1-264)</option><option value="+672">Antarctica	 (+672)</option><option value="+1-268">Antigua	 (+1-268)</option><option value="+54">Argentina	 (+54)</option><option value="+374">Armenia	 (+374)</option><option value="+297">Aruba	 (+297)</option><option value="+247">Ascension	 (+247)</option><option value="+61">Australia	 (+61)</option><option value="+672">Australian External Territories	 (+672)</option><option value="+43">Austria	 (+43)</option><option value="+994">Azerbaijan	 (+994)</option><option value="+1-242">Bahamas	 (+1-242)</option><option value="+973">Bahrain	 (+973)</option><option value="+880">Bangladesh	 (+880)</option><option value="+1-246">Barbados	 (+1-246)</option><option value="+1-268">Barbuda	 (+1-268)</option><option value="+375">Belarus	 (+375)</option><option value="+32">Belgium	 (+32)</option><option value="+501">Belize	 (+501)</option><option value="+229">Benin	 (+229)</option><option value="+1-441">Bermuda	 (+1-441)</option><option value="+975">Bhutan	 (+975)</option><option value="+591">Bolivia	 (+591)</option><option value="+387">Bosnia &amp; Herzegovina	 (+387)</option><option value="+267">Botswana	 (+267)</option><option value="+55">Brazil	 (+55)</option><option value="+1-284">British Virgin Islands	 (+1-284)</option><option value="+673">Brunei Darussalam	 (+673)</option><option value="+359">Bulgaria	 (+359)</option><option value="+226">Burkina Faso	 (+226)</option><option value="+257">Burundi	 (+257)</option><option value="+855">Cambodia	 (+855)</option><option value="+237">Cameroon	 (+237)</option><option value="+1">Canada	 (+1)</option><option value="+238">Cape Verde Islands	 (+238)</option><option value="+1-345">Cayman Islands	 (+1-345)</option><option value="+236">Central African Republic	 (+236)</option><option value="+235">Chad	 (+235)</option><option value="+64">Chatham Island (New Zealand)	 (+64)</option><option value="+56">Chile	 (+56)</option><option value="+86">China (PRC)	 (+86)</option><option value="+61-8">Christmas Island	 (+61-8)</option><option value="+61">Cocos-Keeling Islands	 (+61)</option><option value="+57">Colombia	 (+57)</option><option value="+269">Comoros	 (+269)</option><option value="+242">Congo	 (+242)</option><option value="+243">Congo	 (+243)</option><option value="+682">Cook Islands	 (+682)</option><option value="+506">Costa Rica	 (+506)</option><option value="+225">Ivory Coast	 (+225)</option><option value="+385">Croatia	 (+385)</option><option value="+53">Cuba	 (+53)</option><option value="+5399">Cuba (Guantanamo Bay)	 (+5399)</option><option value="+599">Curaao	 (+599)</option><option value="+357">Cyprus	 (+357)</option><option value="+420">Czech Republic	 (+420)</option><option value="+45">Denmark	 (+45)</option>option value="+246">Diego Garcia	 (+246)</option><option value="+253">Djibouti	 (+253)</option><option value="+1-767">Dominica	 (+1-767)</option>option value="+670">East Timor	 (+670)</option><option value="+56">Easter Island	 (+56)</option><option value="+593">Ecuador	 (+593)</option><option value="+20">Egypt	 (+20)</option><option value="+503">El Salvador	 (+503)</option><option value="+240">Equatorial Guinea	 (+240)</option><option value="+291">Eritrea	 (+291)</option><option value="+372">Estonia	 (+372)</option><option value="+251">Ethiopia	 (+251)</option>option value="+500">Falkland Islands (Malvinas)	 (+500)</option><option value="+298">Faroe Islands	 (+298)</option><option value="+679">Fiji Islands	 (+679)</option><option value="+358">Finland	 (+358)</option><option value="+33">France	 (+33)</option><option value="+596">French Antilles	 (+596)</option><option value="+594">French Guiana	 (+594)</option><option value="+689">French Polynesia	 (+689)</option><option value="+241">Gabonese Republic	 (+241)</option><option value="+220">Gambia	 (+220)</option><option value="+995">Georgia	 (+995)</option><option value="+49">Germany	 (+49)</option><option value="+233">Ghana	 (+233)</option><option value="+350">Gibraltar	 (+350)</option><option value="+30">Greece	 (+30)</option><option value="+299">Greenland	 (+299)</option><option value="+1-473">Grenada	 (+1-473)</option><option value="+590">Guadeloupe	 (+590)</option><option value="+1-671">Guam	 (+1-671)</option><option value="+5399">Guantanamo Bay	 (+5399)</option><option value="+502">Guatemala	 (+502)</option><option value="+245">Guinea-Bissau	 (+245)</option><option value="+224">Guinea	 (+224)</option><option value="+592">Guyana	 (+592)</option><option value="+509">Haiti	 (+509)</option><option value="+504">Honduras	 (+504)</option><option value="+852">Hong Kong	 (+852)</option><option value="+36">Hungary	 (+36)</option><option value="+354">Iceland	 (+354)</option><option value="+91">India	 (+91)</option><option value="+62">Indonesia	 (+62)</option><option value="+871">Inmarsat (Atlantic Ocean - East)	 (+871)</option><option value="+874">Inmarsat (Atlantic Ocean - West)	 (+874)</option><option value="+873">Inmarsat (Indian Ocean)	 (+873)</option><option value="+872">Inmarsat (Pacific Ocean)	 (+872)</option><option value="+800">International Freephone Service	 (+800)</option><option value="+808">International Shared Cost Service (ISCS)	 (+808)</option><option value="+98">Iran	 (+98)</option><option value="+964">Iraq	 (+964)</option><option value="+353">Ireland	 (+353)</option><option value="+972">Israel	 (+972)</option><option value="+39">Italy	 (+39)</option><option value="+1-876">Jamaica	 (+1-876)</option><option value="+81">Japan	 (+81)</option><option value="+962">Jordan (+962)</option><option value="+7">Kazakhstan	 (+7)</option><option value="+254">Kenya	 (+254)</option><option value="+686">Kiribati	 (+686)</option><option value="+850">Korea (North)	 (+850)</option><option value="+82">Korea (South)	 (+82)</option><option value="+965">Kuwait	 (+965)</option><option value="+996">Kyrgyz Republic	 (+996)</option><option value="+856">Laos	 (+856)</option><option value="+371">Latvia	 (+371)</option><option value="+961">Lebanon	 (+961)</option><option value="+266">Lesotho	 (+266)</option><option value="+231">Liberia	 (+231)</option><option value="+218">Libya	 (+218)</option><option value="+423">Liechtenstein	 (+423)</option><option value="+370">Lithuania	 (+370)</option><option value="+352">Luxembourg	 (+352)</option><option value="+853">Macao	 (+853)</option><option value="+389">Macedonia	 (+389)</option><option value="+261">Madagascar	 (+261)</option><option value="+265">Malawi	 (+265)</option><option value="+60">Malaysia	 (+60)</option><option value="+960">Maldives	 (+960)</option><option value="+223">Mali Republic	 (+223)</option><option value="+356">Malta	 (+356)</option><option value="+692">Marshall Islands	 (+692)</option><option value="+596">Martinique	 (+596)</option><option value="+222">Mauritania	 (+222)</option><option value="+230">Mauritius	 (+230)</option><option value="+269">Mayotte Island	 (+269)</option><option value="+52">Mexico	 (+52)</option><option value="+691">Micronesia (+691)</option><option value="+1-808">Midway Island	 (+1-808)</option><option value="+373">Moldova	 (+373)</option><option value="+377">Monaco	 (+377)</option><option value="+976">Mongolia	 (+976)</option><option value="+382">Montenegro	 (+382)</option><option value="+1-664">Montserrat	 (+1-664)</option><option value="+212">Morocco	 (+212)</option><option value="+258">Mozambique	 (+258)</option><option value="+95">Myanmar	 (+95)</option><option value="+264">Namibia	 (+264)</option><option value="+674">Nauru	 (+674)</option><option value="+977">Nepal	 (+977)</option><option value="+31">Netherlands	 (+31)</option><option value="+599">Netherlands Antilles	 (+599)</option><option value="+1-869">Nevis	 (+1-869)</option><option value="+687">New Caledonia	 (+687)</option><option value="+64">New Zealand	 (+64)</option><option value="+505">Nicaragua	 (+505)</option><option value="+227">Niger	 (+227)</option><option value="+234">Nigeria	 (+234)</option><option value="+683">Niue	 (+683)</option><option value="+672">Norfolk Island	 (+672)</option><option value="+47">Norway (+47)</option><option value="+968">Oman	 (+968)</option><option value="+92">Pakistan	 (+92)</option><option value="+680">Palau	 (+680)</option><option value="+970">Palestinian Settlements	 (+970)</option><option value="+507">Panama	 (+507)</option><option value="+675">Papua New Guinea	 (+675)</option><option value="+595">Paraguay	 (+595)</option><option value="+51">Peru	 (+51)</option><option value="+63">Philippines	 (+63)</option><option value="+48">Poland	 (+48)</option><option value="+351">Portugal	 (+351)</option><option value="+974">Qatar (+974)</option><option value="+40">Romania	 (+40)</option><option value="+7">Russia	 (+7)</option><option value="+250">Rwandese Republic	 (+250)</option><option value="+290">St. Helena	 (+290)</option><option value="+1-869">St. Kitts/Nevis	 (+1-869)</option><option value="+1-758">St. Lucia	 (+1-758)</option><option value="+508">St. Pierre &amp; Miquelon	 (+508)</option><option value="+1-784">St. Vincent &amp; Grenadines	 (+1-784)</option><option value="+685">Samoa	 (+685)</option><option value="+378">San Marino	 (+378)</option><option value="+966">Saudi Arabia	 (+966)</option><option value="+221">Senegal	 (+221)</option><option value="+381">Serbia	 (+381)</option><option value="+248">Seychelles Republic	 (+248)</option><option value="+232">Sierra Leone (+232)</option><option value="+65">Singapore	 (+65)</option><option value="+421">Slovak Republic	 (+421)</option><option value="+386">Slovenia	 (+386)</option><option value="+677">Solomon Islands	 (+677)</option><option value="+252">Somali Democratic Republic	 (+252)</option><option value="+27">South Africa	 (+27)</option><option value="+34">Spain	 (+34)</option><option value="+94">Sri Lanka	 (+94)</option><option value="+249">Sudan	 (+249)</option><option value="+597">Suriname	 (+597)</option><option value="+268">Swaziland (+268)</option><option value="+46">Sweden	 (+46)</option><option value="+41">Switzerland	 (+41)</option><option value="+963">Syria	 (+963)</option><option value="+886">Taiwan	 (+886)</option><option value="+992">Tajikistan	 (+992)</option><option value="+255">Tanzania	 (+255)</option><option value="+66">Thailand	 (+66)</option><option value="+670">Timor Leste	 (+670)</option><option value="+228">Togolese Republic	 (+228)</option><option value="+690">Tokelau	 (+690)</option><option value="+676">Tonga Islands	 (+676)</option><option value="+1-868">Trinidad &amp; Tobago	 (+1-868)</option><option value="+216">Tunisia	 (+216)</option><option value="+90">Turkey	 (+90)</option><option value="+993">Turkmenistan (+993)</option><option value="+1-649">Turks and Caicos Islands	 (+1-649)</option><option value="+688">Tuvalu	 (+688)</option><option value="+256">Uganda	 (+256)</option><option value="+380">Ukraine	 (+380)</option><option value="+971">United Arab Emirates	 (+971)</option><option value="+44">United Kingdom (+44)</option><option value="+1">United States of America	 (+1)</option><option value="+1-340">US Virgin Islands	 (+1-340)</option><option value="+598">Uruguay	 (+598)</option><option value="+998">Uzbekistan	 (+998)</option><option value="+678">Vanuatu	 (+678)</option><option value="+379">Vatican City	 (+379)</option><option value="+58">Venezuela	 (+58)</option><option value="+84">Vietnam	 (+84)</option><option value="+808">Wake Island (+808)</option><option value="+681">Wallis and Futuna Islands	 (+681)</option><option value="+967">Yemen	 (+967)</option><option value="+260">Zambia	 (+260)</option><option value="+255">Zanzibar	 (+255)</option><option value="+263">Zimbabwe	 (+263)</option></select>';
		template +=		'<div class="error-line-2 fltlft" style="display:none;"></div>';
		template +=		'<input type="text" name="form-settings-sms-notification-to[]" class="form-settings-sms-notification-to required fltlft" value="" style="width:170px;">';
		template +=		'<a href="javascript:void(0);" rel="" id="remove_number_field">Remove</a>';
		template +=		'<div class="sms-num-status sms-inact">Un-verified <a href="javascript:void(0);" id="" class="verify_number sms_verify">Click to verify</a></div>';
		template +=		'<div class="error-line" style="margin-left:150px;"></div>';
		template +=		'</span>';
		template +=	'</div>';

/*
		template += '<div class="sms_container">';
		template +=		'<span class="new_sms fltlft" style="position:relative;">';
		template +=			'<input style="margin-top:10px" type="text" name="form-settings-sms-notification-to[]" class="form-settings-sms-notification-to fltlft" value="">';
		template +=			'<a href="javascript:void(0);" rel="" id="remove_number_field">Remove</a>';
		template +=			'<div class="sms-num-status sms-inact">Un-verified <a href="#" id="" class="verify_number">(verify)</a></div>';
		template +=			'<div class="error-line"></div>';
		template +=		'</span>';
		template +=	 '</div>';
*/

		$('#sms_field').append(template);
		return false;
	});


	$('#add_another_email').live('click', function()
	{
		$(this).parent('div#email_field').after('<div class="email_container"><span class="fltlft" style="position:relative;"><input type="text" name="form-settings-notification-to[]" class="form-settings-notification-to fltlft vtip-south-focus" value="" vtip-title="Enter email address to receive notification"/><a href="#" id="remove_email">Remove</a></span></div>');
		$('#email_field').append('<div class="email_container"><span class="fltlft" style="position:relative;"><input type="text" name="form-settings-notification-to[]" class="form-settings-notification-to fltlft vtip-south-focus" value="" vtip-title="Enter email address to receive notification"/><a href="#" id="remove_email_field">Remove</a></span></div>');
		return false;
	});

	$('#remove_email_field').live('click', function() 
	{
		$('.tipsy').hide();
		var count = 0;
		$('#email_field').find('.email_container').each(function() {
				count++;
		});

		var real_count = count-1;
		if(real_count <= 0) {
			alert('Atleast one email-id is compulsory');
		}else {
			$(this).parents('div.email_container').remove();
		}
		return false;
	});
	

	$('#remove_number_field').live('click', function() 
	{
		$('.tipsy').hide();
		var count = 0;
		$('#sms_field').find('.sms_container').each(function() {
				count++;
		});

		var real_count = count-1;
		if(real_count <= 0) {
			alert('Atleast one number is compulsory');
		}else {

			var number = $(this).attr('rel');

			if(number != '') {

				var url		= base_path+'form/remove_phone_number';
				var form_id = $('#form_id').val();

				var $current = $(this);

				$.post(url, { form_id : form_id, number : number }, function(data) {

					$current.parents('div.sms_container').remove();
				});
			}else {
				$(this).parents('div.sms_container').remove();
			}
		}

		return false;
	});

	//NOTIIFICATION settings save
	$('.save-notification-settings').live('click', function() 
	{
		var id = $(this).attr('id');

		var submission_data_type = '';

		var form_settings_notification_to	=	new Array();
		var allEmailFieldsValid				=	true;
		var cnt_email						=	0;
		var error							=	0;

		if($('#form-settings-notification-check').is(':checked')) {

			$(".form-settings-notification-to").each(function() {

				if($(this).val() != '') {

					var pattern	= /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/;
					var result	= pattern.test($(this).val());
		
					if(!result) {
						error++;
					}else {
						form_settings_notification_to[cnt_email]	=	$(this).val();
						cnt_email++;
					}
				}

			});

			if(error > 0) {
				$('.error-line').html('').fadeOut('fast');
				$('.error-line').html('Please enter valid email').fadeIn('fast');
				$('.form-settings-notification-to').css('border', '1px solid red');
				$('.form-settings-notification-to').focus();
				return false;
			}

			var from =	'';

			if(from != '') {

				var pattern	= /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/;
				var result	= pattern.test(from);

				if(!result) {
					$('.error-line').html('').fadeOut('fast');
					$('.form-settings-notification-to').css('border', '');
					$('.error-line-2').html('Please enter valid from email-id').fadeIn('fast');
					$('#form-settings-notification-from').css('border', '1px solid red');
					$('#form-settings-notification-from').focus();
					return false;
				}else {
					var form_settings_notification_from	=	from;
				}
			}
		}

		var form_settings_notification_check		=	$('#form-settings-notification-check').is(':checked') ? 'yes' : 'no';

		var from_user_email_check					=	$('#from-user-email-check').is(':checked') ? 'yes' : 'no';

		var user_email_address						=	$('#user_email_address').val();

		var form_settings_notification_from_name	=	$('#form-settings-notification-from-name').val();

		if(form_settings_notification_from_name != '') {

			var regex = new RegExp("^[a-zA-Z0-9 ]+$");
			if(!regex.test(form_settings_notification_from_name)) {
				$('.error-line-2').html('Please enter alpha numeric characters only').fadeIn('fast');
				$('#form-settings-notification-from-name').css('border', '1px solid red');
				$('#form-settings-notification-from-name').focus();
				return false;
			}
		}

		var form_settings_notification_subject		=	$('#form-settings-notification-subject').val();
		var form_settings_submission_data_check		=	$('#form-settings-submission-data-check').is(':checked') ? 'yes' : 'no';
		var form_settings_submission_data_2_check	=	$('#form-settings-submission-data-2-check').is(':checked') ? 'yes' : 'no';

		var form_settings_submission_msg			=	$('#form-settings-submission-msg').val();
		var form_settings_submission_msg_line		=	$('#form-settings-submission-msg-line').val();

		var notifi_without_FormName					=	$('#notifi_without_FormName').is(':checked') ? 1 : 0;

		var notifi_without_temp						=	$('#notifi_without_temp').is(':checked') ? 1 : 0;

		var header_image_name	= '';
		var header_width		= '';
		var header_height		= '';
		var header_alignment	= '';

		var footer_image_name	= '';
		var footer_width		= '';
		var footer_height		= '';
		var footer_alignment	= '';

		if(notifi_without_temp == 1) {

			header_image_name	= $('#header_image_name').val();
			header_width		= $('#header_width').val();
			header_height		= $('#header_height').val();
			header_alignment	= $('#header_alignment').val();

			footer_image_name	= $('#footer_image_name').val();
			footer_width		= $('#footer_width').val();
			footer_height		= $('#footer_height').val();
			footer_alignment	= $('#footer_alignment').val();
		}

		//----------------------var optionTexts = [];
		var notification_fields_values = [];
		$('#form-settings-submission-data-checkbox').find('input').each(function() {
			if($(this).is(':checked')){
				notification_fields_values.push($(this).attr('id'));
			}
		});
		//-------------------------------------------------------------------------------

		//---------------------- var more_info_optionTexts = [];
		var more_info	=	$('#more_info').is(':checked') ? 'yes' : 'no';

		var more_info_notification = [];
		$('#more_info_about_submission').find('input').each(function() {
			if($(this).is(':checked')){
				more_info_notification.push($(this).attr('id'));
			}
		});
		//-------------------------------------------------------------------------------

		$('.submission-data-type').each(function() {
			if($(this).is(':checked')) {
				submission_data_type = $(this).val();			
			}
		});

		var form_id	=  $('#form_id').val();

		var url = base_path+'form/save_notification_settings/';

		$('#'+id).find('a').html('Saving...');

		$.post(url, {
				form_id									: form_id, 
				form_settings_notification_check		: form_settings_notification_check, 
				form_settings_notification_to			: form_settings_notification_to, 
				from_user_email_check					: from_user_email_check, 
				user_email_address						: user_email_address, 
				form_settings_notification_from			: form_settings_notification_from,
				form_settings_notification_from_name	: form_settings_notification_from_name,
				form_settings_notification_subject		: form_settings_notification_subject,
				form_settings_submission_data_check		: form_settings_submission_data_check, 
				form_settings_submission_data_2_check	: form_settings_submission_data_2_check, 
				form_settings_submission_msg			: form_settings_submission_msg, 
				form_settings_submission_msg_line		: form_settings_submission_msg_line, 
				submission_data_type					: submission_data_type,
				notification_fields_values				: notification_fields_values,
				more_info								: more_info,
				more_info_notification					: more_info_notification,
				notifi_without_FormName					: notifi_without_FormName,
				notifi_without_temp						: notifi_without_temp,
				header_image_name						: header_image_name,
				header_width							: header_width,
				header_height							: header_height,
				header_alignment						: header_alignment,
				footer_image_name						: footer_image_name,
				footer_width							: footer_width,
				footer_height							: footer_height,
				footer_alignment						: footer_alignment
			},
			function(data) {

				$('#'+id).find('a').html('Saved');				

				if(id == 'save-notification-settings-next') {
					window.location.hash = 'show-sms-notification-settings';
				}else if(id == 'save-notification-settings-back') {
					window.location.hash = 'show-security-settings';
				}else if(id == 'notification_test_mail') {

					var url = base_path+'form/fire_notification_test_mail';

					$('.main-loader').slideDown("slow");

					$.post(url, { form_id : form_id }, function(data) {

						$('.main-loader').slideUp("slow");

						if(data == 'sent') {

							$('#test_mail_hidden_td').fadeIn(function() {

								$('#mail_failure').hide();
								$('#mail_success').html('Mail has been sent to your above email address').show();
							});
						}else {

							$('#test_mail_hidden_td').fadeIn(function() {

								$('#mail_success').hide();
								$('#mail_failure').html('Something went wrong please contact support@form2pay.com !').show();
							});
						}
					});
				}else {
					$('#form-overlay').click();
				}
			});
	});

	$('.save-sms-settings').live('click', function() {

		var id = $(this).attr('id');

		var sms_notification_to_country_code	=	new Array();
		var sms_notification_to					=	new Array();
		var cnt_sms								=	0;
		var cnt_country_code					=	0;
		var error								=	0;
		var error2								=	0;

		if($('#form-settings-sms-check').is(':checked')) {

			$(".form-settings-sms-notification-to").each(function() {

				if($(this).val() != '') {

					var filter  = /^[0-9-+]+$/;
					var result	= filter.test($(this).val());
	
					if(!result) {
						$(this).parents('span.new_sms').find('.form-settings-sms-notification-to').css('border', '1px solid red');
						$(this).parents('span.new_sms').find('.error-line').html('Please enter valid phone number').show();
						error++;
						return false;
					}else {
						$('.form-settings-sms-notification-to').css('border', '');
						$(this).parents('span.new_sms').find('.error-line').html('').hide();
						sms_notification_to[cnt_sms] = $(this).val();
						cnt_sms++;
					}
				}
			});

			if(error > 0) {
				$('.error-line').html('').fadeOut('fast');
//					$('.error-line').html('Please enter valid phone number').fadeIn('fast');
//					$('.form-settings-sms-notification-to').css('border', '1px solid red');
//					$('.form-settings-sms-notification-to').focus();
				return false;
			}

			$(".country_code").each(function() {

				var country_code = $(this).val();

				if(country_code == -1) {
					$(this).parents('span.new_sms').find('.error-line').html('Select the country code to get the SMS Notification').show();
					error2++;
					return false;
				}else {
					var mob_number = $(this).parents('span.new_sms').find('.form-settings-sms-notification-to').val();
					$(this).parents('span.new_sms').find('.error-line').html('').hide();
					sms_notification_to_country_code[cnt_country_code] = country_code+'~'+mob_number;
					cnt_country_code++;
				}
			});

			if(error2 > 0) {
//					$('.error-line').html('').fadeOut('fast');
//					$('.error-line').html('Select the country code to get the SMS Notification').fadeIn('fast');
				return false;
			}

			if(sms_notification_to == '') {
				$('.error-line').html('').fadeOut('fast');
				$('.error-line').html('Please enter your phone number').fadeIn('fast');
				$('.form-settings-sms-notification-to').css('border', '1px solid red');
				$('.form-settings-sms-notification-to').focus();
				return false;					
			}
		}

		var form_settings_sms_check	=	$('#form-settings-sms-check').is(':checked') ? 'yes' : 'no';
		var timezone				=	$('#DropDownTimezone').val();
		var at_any_time				=	$('#at_any_time').is(':checked') ? 'yes' : 'no';
		var desired_time			=	$('#desired_time').is(':checked') ? 'yes' : 'no';
		var from_time				=	$('#from_time').val();
		var to_time					=	$('#to_time').val();
		var submission_link_check	=	$('#submission_link').is(':checked') ? 'yes' : 'no';
		var customize_data_check	=	$('#customize_data').is(':checked') ? 'yes' : 'no';
		var submission_msg			=	$('#form-settings-submission-msg').val();
		var submission_data_check	=	$('#form-settings-submission-data-check').is(':checked') ? 'yes' : 'no';
		var submission_data_2_check	=	$('#form-settings-submission-data-2-check').is(':checked') ? 'yes' : 'no';
		var field_label				=	$('#field_label').is(':checked') ? 'yes' : 'no';

		//---------------------- var optionTexts = [];
		var notification_fields_values = [];
		$('#form-settings-submission-data-checkbox').find('input').each(function() {
			if($(this).is(':checked')){
				notification_fields_values.push($(this).attr('id'));
			}
		});
		//-------------------------------------------------------------------------------

		var form_id	=  $('#form_id').val();

		var url = base_path+'form/save_sms_notification_settings/';

		$('.main-loader').slideDown("slow");

		$('#'+id).find('a').html('Saving...');

		$.post(url, {
				form_id							 : form_id, 
				form_settings_sms_check			 : form_settings_sms_check, 
				sms_notification_to_country_code : sms_notification_to_country_code, 
				sms_notification_to				 : sms_notification_to, 
				timezone						 : timezone,
				at_any_time						 : at_any_time,
				desired_time					 : desired_time,
				from_time						 : from_time,
				to_time							 : to_time,
				submission_link_check			 : submission_link_check,
				customize_data_check			 : customize_data_check,
				submission_msg					 : submission_msg, 
				submission_data_check			 : submission_data_check, 
				submission_data_2_check			 : submission_data_2_check, 
				notification_fields_values		 : notification_fields_values,
				field_label						 : field_label
			}, function(data) {

				if(id == 'save-sms-settings-back') {
				
					window.location.hash = 'show-notification-settings';

				}else if(id == 'save-sms-settings-next') {
				
					window.location.hash = 'show-auto-responder-settings';
				}
				$('#form-overlay').click();
			});
	});


	// Back to autoresponder settings
	$('.back-to-auto-responder-settings').live('click', function()
	{
		var form_id	 =  $('#form_id').val();
		var id		 =	$(this).attr('id');
		var href	 =	$(this).find('a').attr('href'); 

		var page_style = '';
		$('.page-style').each(function(){
			if($(this).is(':checked')){
				page_style = $(this).val();
			}
		});

		if(page_style == 'standard') {

			var form_settings_success_page_body  =	$('#form-settings-success-page-body').val();
			
			var form_settings_success_page_redirect_url = '';
			var url_email_id = '';

			var url = base_path+'form/save_successpage_settings/';

			$.post(
				url, 
				{ form_id : form_id, form_settings_success_page_body : form_settings_success_page_body, form_settings_success_page_redirect_url : form_settings_success_page_redirect_url, page_style : page_style, url_email_id : url_email_id },
				function(data) {

					if(id == 'save-successpage-settings-back') {

						window.location.hash = '#show-auto-responder-settings';
						return false;
//						window.location.hash = 'show-payment-settings';

					}else {

						$('#form-overlay').click();
					}
			});
		}else {

			window.location.hash = 'show-payment-settings';
		}

	});

	// Back to success page settings
	$('#back-to-success-page').live('click', function()
	{
		window.location.hash = 'show-success-page-settings';
	});

	//SUCCESS PAGE save
	$('.save-successpage-settings').live('click', function() 
	{
		var form_id	 =  $('#form_id').val();
		var id		 =	$(this).attr('id');
		var href	 =	$(this).find('a').attr('href'); 

		var page_style = '';
		$('.page-style').each(function(){
			if($(this).is(':checked')){
				page_style = $(this).val();
			}
		});

		if(page_style == 'standard') {

			var form_settings_success_page_body  =	$('#form-settings-success-page-body').val();
			
			var form_settings_success_page_redirect_url = '';
			var url_email_id = '';

			var url = base_path+'form/save_successpage_settings/';

			$('#'+id).find('a').html('Saving...');

			$.post(
				url, 
				{ form_id : form_id, form_settings_success_page_body : form_settings_success_page_body, form_settings_success_page_redirect_url : form_settings_success_page_redirect_url, page_style : page_style, url_email_id : url_email_id },
				function(data) {
					$('#'+id).find('a').html('Saved');
					
					window.location	= href;
			});

		}else {

			window.location	= href;
		}

		return false;
	});


	$('.successfull_redirect_url').live('keyup', function() {

		var hidden_user_url			= $('#hidden_user_url').val();

		var splitted_url			= hidden_user_url.split('www.');

		var splitted_url_again		= splitted_url[1].split('.');
		
		var hidden_user_domain_name	= splitted_url_again[0];

		var redirect_url = '';
		$('.redirect-url').each(function(){
			redirect_url += $(this).val();
		});

		if(redirect_url == 'http://')
		{
			$('.error-line').html('').fadeOut('fast');
			$('.redirect-url-2').parent('span').css('border', '');
			$('.error-line').html('Please enter redirect URL').fadeIn('fast');
			$('.redirect-url-2').parent('span').css('border', '1px solid red');
			$('.redirect-url-2').focus();
			return false;
		}else {
			var pattern = /^(http\:\/\/|https\:\/\/)[A-Za-z0-9_-]+\.+[A-Za-z0-9.\/%&=\?_:;-]+$/;
//			var pattern	= new RegExp("^(http:\/\/www.|https:\/\/www.|ftp:\/\/www.|www.){1}([0-9A-Za-z]+\.)");
			var result	= pattern.test(redirect_url);

			if(!result) {
				$('.error-line').html('').fadeOut('fast');
				$('.redirect-url-2').parent('span').css('border', '');
				$('.error-line').html('Please enter valid URL').fadeIn('fast');
				$('.redirect-url-2').parent('span').css('border', '1px solid red');
				$('.redirect-url-2').focus();
				return false;
			}else {
				var form_settings_success_page_redirect_url	= redirect_url;

				var splitted_url			= form_settings_success_page_redirect_url.split(/\./);
//				var splitted_url			= form_settings_success_page_redirect_url.split('www.');

				var splitted_url_again		= splitted_url[1].split('.');
				
				var user_domain_name		= splitted_url_again[0];
			}
		}

		if(user_domain_name != hidden_user_domain_name) {

			$('#hide_email_id_fields').show();
			$('#save-successpage-settings-next').hide();
			$('.check_email_id').show();

		}else {
			return true;
		}
	});

	$('#manually_review').live('click', function() {

		$('.hide_email_id_fields').hide();
		$('.hidden_text').hide();
		$('#unverified_msg').show();
		$('.check_email_id').hide();

		var form_settings_success_page_body	= '';
		var form_settings_success_page_redirect_url = '';
		var url_email_id = '';
		var form_id	= $('#form_id').val();

		var page_style = '';
		$('.page-style').each(function(){
			if($(this).is(':checked')){
				page_style = $(this).val();
			}
		});

		var redirect_url = '';
		$('.redirect-url').each(function() {
			redirect_url += $(this).val();
		});

		if(redirect_url == 'http://')
		{
			$('.errormessage').html('Please enter redirect URL').fadeIn('fast');
			$('.redirect-url-2').css('border', '1px solid red');
			$('.redirect-url-2').focus();

			return false;
		}else {
			$('.errormessage').html('');
			$('#top_msg').hide();
			$('.redirect-url-2').css('border', '');

			var form_settings_success_page_redirect_url	= redirect_url;
		}

		var url	= base_path+'form/save_successpage_settings/';

		$.post(
			url, 
			{ form_id : form_id, form_settings_success_page_body : form_settings_success_page_body, form_settings_success_page_redirect_url : form_settings_success_page_redirect_url, page_style : page_style, url_email_id : url_email_id, manually_review : 'manually_review' },
			function(data) {

				if(data == 'success') {
					$('.successpage_next').hide();
					$('#success_buttons_2').fadeIn('fast');
					$('.errormessage').hide('fast');
					$('.greenmessage').html('Your URL has been forwarded to our team for a manual review. * Please note this process might takes upto 24 hours.').fadeIn('fast');
				}else {
					$('.successpage_next').hide();
					$('#success_buttons_2').fadeIn('fast');
					$('.greenmessage').hide('fast');
					$('.errormessage').html('Something went wrong please contact at support@form2pay.com').fadeIn('fast');
				}
		});

		return false;
	});

	$('#check_status_2').live('click', function(){

		var form_id = $(this).attr('rel');

		var url = base_path+'form/check_successpage_redirect_flag/';

		$.post(url,{form_id : form_id},function(data){
			if(data == 0){
				$('.greenmessage').hide();
				$('.errormessage').html('Unverified').fadeIn('fast');
				return false;
			}else{
				window.location.reload();
			}
		});
	});


	$('#check_email_id').live('click', function() {

		$('#success_buttons_2').hide();

		var form_settings_success_page_body  =	'';
		var form_id	= $('#form_id').val();
		var id		= $(this).attr('id');
		var href	= $(this).find('a').attr('href'); 

		var page_style = '';
		$('.page-style').each(function(){
			if($(this).is(':checked')){
				page_style = $(this).val();
			}
		});

		var redirect_url = '';
		$('.redirect-url').each(function(){
			redirect_url += $(this).val();
		});

		if(redirect_url == 'http://')
		{
			$('.greenmessage').hide('fast');
			$('.errormessage').html('Please enter redirect URL').fadeIn('fast');
			$('.redirect-url-2').css('border', '1px solid red');
			$('.redirect-url-2').focus();
			return false;

		}else {
			var pattern = /^(http\:\/\/|https\:\/\/)[A-Za-z0-9_-]+\.+[A-Za-z0-9.\/%&=\?_:;-]+$/;
			var result	= pattern.test(redirect_url);

			if(!result) {
				$('.greenmessage').hide('fast');
				$('.errormessage').html('Please enter valid URL').fadeIn('fast');
				$('.redirect-url-2').css('border', '1px solid red');
				$('.redirect-url-2').focus();
				return false;
			}else {
				$('.greenmessage').hide('fast');
				$('.errormessage').html('');
				$('.redirect-url-2').css('border', '');
				var form_settings_success_page_redirect_url	= redirect_url;

				var splitted_url			= form_settings_success_page_redirect_url.split(/\./);
//				var splitted_url			= form_settings_success_page_redirect_url.split('www.');

				var splitted_url_again		= splitted_url[1].split('.');
				
				var user_domain_name		= splitted_url_again[0];
			}
		}

		var url = base_path+'form/check_registered_email_id';
		var url_email_id = '';

		$.post(
			url, 
			{ form_id : form_id, form_settings_success_page_body : form_settings_success_page_body, form_settings_success_page_redirect_url : form_settings_success_page_redirect_url, page_style : page_style, user_domain_name : user_domain_name, url_email_id : url_email_id },
			function(data) {

				if(data == 'matched') {

					$('.resend_verification_email').hide();
					$('#unverified_msg').hide();
					$('#verified_msg').show();
					$('.verify_email_id').hide();
					$('.successpage_next').hide();
					$('.hidden_text').hide();
					$('#form-settings-success-page-email-id').hide();
					$('.errormessage').hide();
					$('.greenmessage').html('Your URL is verified').fadeIn('fast');
				}else {

					$('#unverified_msg').show();
					$('#verified_msg').hide();

					$('.hidden_text').show();

					var email_id = $('#form-settings-success-page-email-id').val();

					var count = 0;
					if(email_id == '') {
						$('.errormessage').html('Please enter your domain email-id').fadeIn('fast');
						$('.redirect-url-email-id').css('border', '1px solid red');
						$('.redirect-url-email-id').focus();
						if(count == 0) {
							$('.redirect-url-email-id').val('@'+splitted_url[1]);
							count = 1;
						}
						return false;
					}else {
						var pattern	= /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/;
						var result	= pattern.test(email_id);

						if(!result) {
							$('.errormessage').html('Please enter valid email ').fadeIn('fast');
							$('.redirect-url-email-id').css('border', '1px solid red');
							$('.redirect-url-email-id').focus();
							return false;
						}else {
							$('.errormessage').html('');
							$('.redirect-url-email-id').css('border', '');
							url_email_id =	email_id;

							var splitted_email_id		= url_email_id.split('@');

							var splitted_email_id_again	= splitted_email_id[1].split('.');

							var email_id_domain_name	= splitted_email_id_again[0];
						}
					}
				
					if(email_id_domain_name == user_domain_name) {

						var url = base_path+'form/check_url_email_id/';

						$.post(
							url, 
							{ form_id : form_id, url_email_id : url_email_id },
							function(data) {

								if(data == 'sent') {

									var url = base_path+'form/save_successpage_settings/';

									$('#'+id).find('a').html('Saving...');

									$.post(
										url, 
										{ form_id : form_id, form_settings_success_page_body : form_settings_success_page_body, form_settings_success_page_redirect_url : form_settings_success_page_redirect_url, page_style : page_style, url_email_id : url_email_id },
										function(data) {

											$('.verify_email_id').hide();
											$('.successpage_next').hide();
											$('#success_buttons_2').hide('fast');
											$('#success_buttons').fadeIn('fast');
											$('.errormessage').hide('fast');
											$('.greenmessage').html('A mail has been sent to your email account please click on the verification link in the mail to verify the redirection URL').fadeIn('fast');
									});
									return false;
								}else {
									$('.redirect-url-email-id').css('border', '');
									$('.errormessage').html('Mail sent failure').fadeIn('fast');
									return false;
								}
						});
					}else {
						$('.errormessage').html('Non-matching Email ID, please make sure your domain name is embedded in the email id').fadeIn('fast');
						$('.redirect-url-email-id').css('border', '1px solid red');
						$('.redirect-url-email-id').focus();
						return false;
					}
				}
		});
		return false;
	});

	$('#check_status').live('click', function(){

		var form_id = $(this).attr('rel');

		var url = base_path+'form/check_successpage_redirect_flag/';

		$.post(url,{form_id : form_id},function(data){
			if(data == 0){
				$('.greenmessage').hide();
				$('.errormessage').html('A mail has been sent to the above mentioned email-id, please verify by clicking on the link in the mail').fadeIn('fast');
				return false;
			}else{
				window.location.reload();
			}
		});
	});

	$('#success-preview').live('click', function()
	{
		$('#tool-settings').click();

		var href								=	 $(this).attr('href');
		var form_settings_success_page_body		=	 $('#form-settings-success-page-body').val();

		var form_settings_success_page_redirect_url = '';
		$('.redirect-url').each(function() {
			form_settings_success_page_redirect_url += $(this).val();
		});

		var page_style							=	 '';
		var form_id								=	 $('#form_id').val();

		$('.page-style').each(function() {
			if($(this).is(':checked')) {
				page_style = $(this).val();
			}
		});

		var url_email_id = '';

		var url = base_path+'form/save_successpage_settings/';

		$.post(
			url, 
			{ form_id : form_id, form_settings_success_page_body : form_settings_success_page_body, form_settings_success_page_redirect_url : form_settings_success_page_redirect_url, page_style : page_style, url_email_id : url_email_id }, 
			function(data) {

			}
		);
	});
});

/*-------------------Form Settings JS End-------------------*/

/*-------------------Edit Title Code------------------------*/

$(document).ready(function() {

	var h1_text = '';
	var new_h1_text = '';

	$('#edit-title, #edit-title-h1').click(function(e) {

		h1_text = $('#edit-title-h1').html();

		e.preventDefault();

		$('#edit-title').hide();		
		$('#edit-title-h1').hide();
		$('#edit-title-input').val(h1_text).show().css('font-style','italic').select();
	});

	$('#edit-title-input').blur(function() {

		new_h1_text = $(this).val();
		var form_id	= $('#form_id').val();

		url = base_path+'form/edit_live_title/';

		$.post(url, {form_id : form_id, new_h1_text : new_h1_text}, function(data)
		{
			$('#edit-title-h1').html('').html(new_h1_text);
			$('#edit-title-input').hide();
			$('#edit-title-h1').show();
			$('#edit-title').show();		
		});
	});
});

/*-------------------Edit Title Code end--------------------*/


/*-------------------Edit Footer Code------------------------*/

$(document).ready(function() {

	var h1_text = '';
	var new_h1_text = '';

	$('#edit-footer,#edit-footer-h1').click(function(e) {

		h1_text = $('#edit-footer-h1').html();

		e.preventDefault();

		$('#edit-footer').hide();		
		$('#edit-footer-h1').hide();
		$('#edit-footer-input').val(h1_text).show().css('font-style','italic').select();
	
	});

	$('#edit-footer-input').blur(function() {

		new_h1_text = $(this).val();
		var form_id	= $('#form_id').val();

		url = base_path+'form/edit_live_footer/';

		$.post(url, {form_id : form_id, new_h1_text : new_h1_text}, function(data)
		{
			$('#edit-footer-h1').html('').html(new_h1_text);
			$('#edit-footer-input').hide();
			$('#edit-footer-h1').show();
			$('#edit-footer').show();		
		});
	});
});

/*-------------------Edit Footer Code end--------------------*/

/*-------------------Live edit Code----------------------------*/

	//LABEL

	$('.label-trigger').live('keyup', function() {

		$(this).parents('.single-field').find('.actual_label').html($(this).val());
	});

	//REQUIRED

	$('.required-trigger').live('change', function(){

		$(this).parents('.single-field').find('.fld-required').toggle();
		if($(this).is(':checked') || $(this).parents('.single-field').find('.unique-trigger').is(':checked')){
			$(this).parents('.single-field').find('.hidden-trigger').attr("checked", false);
			$(this).parents('.single-field').find('.hidden-trigger').attr("disabled", true);
		}else{
			$(this).parents('.single-field').find('.hidden-trigger').removeAttr("disabled");
		}
	});

	//UNIQUE

	$('.unique-trigger').live('change', function() {

		if($(this).is(':checked') || $(this).parents('.single-field').find('.required-trigger').is(':checked')){
			$(this).parents('.single-field').find('.hidden-trigger').attr("checked", false);
			$(this).parents('.single-field').find('.hidden-trigger').attr("disabled", true);
		}else{
			$(this).parents('.single-field').find('.hidden-trigger').removeAttr("disabled");
		}
	});

	//Hidden

	$('.hidden-trigger').live('change', function() {

		if($(this).is(':checked')) {

			//lower the opacity to give hidden effect
			$(this).parents('.single-field').find('.actual_label').addClass('force_lower_opacity');
			$(this).parents('.single-field').find('.actual_default').addClass('force_lower_opacity');
			$(this).parents('.single-field').find('input[name=field_min_char]').val('').attr('disabled', true);
			$(this).parents('.single-field').find('.required-trigger').attr("disabled", true);
			$(this).parents('.single-field').find('.unique-trigger').attr("disabled", true);

		}else {

			//remove the hidden effect
			$(this).parents('.single-field').find('.actual_label').removeClass('force_lower_opacity');
			$(this).parents('.single-field').find('.actual_default').removeClass('force_lower_opacity');
			$(this).parents('.single-field').find('input[name=field_min_char]').attr('disabled', false);
			$(this).parents('.single-field').find('.required-trigger').removeAttr("disabled");		
			$(this).parents('.single-field').find('.unique-trigger').removeAttr("disabled");		
		}
	});

	//DEFAULT

	$('.default_trigger').live('keyup', function() {

		$(this).parents('.single-field').find('.actual_default').val($(this).val());
	});

	//FIELD SIZE

	$('.field-size-trigger').live('change',function() {

		var new_size = 'fld-' + $(this).val(); 
	
		$(this).parents('.single-field').find('.actual_default').removeClass('fld-small fld-medium fld-large').addClass(new_size);
	});

	// NUMBER OF COLUMNS

	$('.column-trigger').live('keyup', function(){

		if($(this).val() < 51 && $(this).val() > 0){
	
			$(this).parents('.single-field').find('.actual_default').attr('cols', $(this).val());
		}
	});

	// NUMBER OF ROWS

	$('.row-trigger').live('keyup', function(){

		if($(this).val() < 21 && $(this).val() > 0){
	
			$(this).parents('.single-field').find('.actual_default').attr('rows', $(this).val());
		}
	});

	//FIELD PREFIX

	$('.prefix-trigger').live('change', function(){

		var $instance = $(this).parents('.single-field').find('.actual-prefix');
	
		if($instance.hasClass('hide-prefix')){
		
			$instance.removeClass('hide-prefix').addClass('show-prefix');
		
		}else if($instance.hasClass('show-prefix')){
		
			$instance.removeClass('show-prefix').addClass('hide-prefix');
		}
	});


	//FIELD MIDDLE NAME

	$('.middle-trigger').live('change', function(){
	
		var $instance = $(this).parents('.single-field').find('.actual-middle');
	
		if($instance.hasClass('hide-middle')) {

			$instance.removeClass('hide-middle').addClass('show-middle');
		
		}else if($instance.hasClass('show-middle')) {

			$instance.removeClass('show-middle').addClass('hide-middle');
		}
	});

	//ADDRESS LINE 1

	$('.address1-trigger').live('change', function(){
	
		var $instance = $(this).parents('.single-field').find('.actual-address1');
	
		if($instance.hasClass('hide-address1')){

			$instance.removeClass('hide-address1').addClass('show-address1');
		
		}else if($instance.hasClass('show-address1')){
		
			$instance.removeClass('show-address1').addClass('hide-address1');
		}
	});


	//ADDRESS LINE 2

	$('.address2-trigger').live('change', function(){
	
		var $instance = $(this).parents('.single-field').find('.actual-address2');
	
		if($instance.hasClass('hide-address2')){
		
			$instance.removeClass('hide-address2').addClass('show-address2');
		
		}else if($instance.hasClass('show-address2')){
		
			$instance.removeClass('show-address2').addClass('hide-address2');
		}
	});

	//CITY

	$('.city-trigger').live('change', function(){
	
		var $instance = $(this).parents('.single-field').find('.actual-city');
	
		if($instance.hasClass('hide-city')){
		
			$instance.removeClass('hide-city').addClass('show-city');
		
		}else if($instance.hasClass('show-city')){
		
			$instance.removeClass('show-city').addClass('hide-city');
		}
	});

	//STATE

	$('.state-trigger').live('change', function(){
	
		var $instance = $(this).parents('.single-field').find('.actual-state');
	
		if($instance.hasClass('hide-state')){
		
			$instance.removeClass('hide-state').addClass('show-state');
		
		}else if($instance.hasClass('show-state')){
		
			$instance.removeClass('show-state').addClass('hide-state');
		}
	});

	//ZIPCODE

	$('.zipcode-trigger').live('change', function(){
	
		var $instance = $(this).parents('.single-field').find('.actual-zipcode');
	
		if($instance.hasClass('hide-zipcode')){
		
			$instance.removeClass('hide-zipcode').addClass('show-zipcode');
		
		}else if($instance.hasClass('show-zipcode')){
		
			$instance.removeClass('show-zipcode').addClass('hide-zipcode');
		}
	});

	//COUNTRY

	$('.country-trigger').live('change', function(){
	
		var $instance = $(this).parents('.single-field').find('.actual-country');
	
		if($instance.hasClass('hide-country')){
		
			$instance.removeClass('hide-country').addClass('show-country');
		
		}else if($instance.hasClass('show-country')){
		
			$instance.removeClass('show-country').addClass('hide-country');
		}
	});

	//HEADING

	$('.field-description-trigger').live('keyup', function(){
	
		$(this).parents('.single-field').find('.actual-heading').html($(this).val());
	});

	//SUB-HEADING

	$('.field-description-sub-trigger').live('keyup', function(){
	
		$(this).parents('.single-field').find('.actual-sub-heading').html($(this).val());
	});

	//HOURS-SUBLABEL-TRIGGER

	$('.hours_trigger').live('keyup', function() {

		$(this).parents('.single-field').find('.hours-sub-label').html($(this).val());
	});

	//MINUTES-SUBLABEL-TRIGGER

	$('.minutes_trigger').live('keyup', function() {

		$(this).parents('.single-field').find('.minutes-sub-label').html($(this).val());
	});

	//SECONDS-SUBLABEL-TRIGGER

	$('.seconds_trigger').live('keyup', function() {

		$(this).parents('.single-field').find('.seconds-sub-label').html($(this).val());
	});

	//ADDRESS-LINE-1-SUBLABEL-TRIGGER

	$('.address_line_1_sub_label_trigger').live('keyup', function() {

		$(this).parents('.single-field').find('.address-line-1').html($(this).val());
	});

	//ADDRESS-LINE-2-SUBLABEL-TRIGGER

	$('.address_line_2_sub_label_trigger').live('keyup', function() {

		$(this).parents('.single-field').find('.address-line-2').html($(this).val());
	});

	//ADDRESS-CITY-SUBLABEL-TRIGGER

	$('.addr_city_sub_label_trigger').live('keyup', function() {

		$(this).parents('.single-field').find('.addr-city-sub-label').html($(this).val());
	});

	//ADDRESS-STATE-SUBLABEL-TRIGGER

	$('.addr_state_sub_label_trigger').live('keyup', function() {

		$(this).parents('.single-field').find('.addr_state-sub-label').html($(this).val());
	});

	//ADDRESS-ZIP-CODE-SUBLABEL-TRIGGER

	$('.addr_zip_code_sub_label_trigger').live('keyup', function() {

		$(this).parents('.single-field').find('.addr-zip-code-sub-label').html($(this).val());
	});

	//ADDRESS-COUNTRY-SUBLABEL-TRIGGER

	$('.addr_country_sub_label_trigger').live('keyup', function() {

		$(this).parents('.single-field').find('.addr-country-sub-label').html($(this).val());
	});

	//PREFIX-SUBLABEL-TRIGGER

	$('.fn_prefix_trigger').live('keyup', function() {

		$(this).parents('.single-field').find('.fn-prefix').html($(this).val());
	});

	//FIRST-NAME-SUBLABEL-TRIGGER

	$('.fn_first_name_trigger').live('keyup', function() {

		$(this).parents('.single-field').find('.fn-first-name').html($(this).val());
	});

	//MIDDLE-NAME-SUBLABEL-TRIGGER

	$('.fn_middle_name_trigger').live('keyup', function() {

		$(this).parents('.single-field').find('.fn-middle-name').html($(this).val());
	});

	//LAST-NAME-SUBLABEL-TRIGGER

	$('.fn_last_name_trigger').live('keyup', function() {

		$(this).parents('.single-field').find('.fn-last-name').html($(this).val());
	});

	//EMAIL-SUBLABEL-TRIGGER

	$('.email_sublabel_trigger').live('keyup', function(){
	
		$(this).parents('.single-field').find('.sub-label').html($(this).val());
	});

	//WEB-SUBLABEL-TRIGGER

	$('.web_sublabel_trigger').live('keyup', function(){
	
		$(this).parents('.single-field').find('.sub-label').html($(this).val());
	});

	//AMOUNT-1-SUBLABEL-TRIGGER

	$('.amount_sub_label_trigger').live('keyup', function() {

		$(this).parents('.single-field').find('.amount-sub-label').html($(this).val());
	});

	//currency_format_trigger

	$('.currency_format_trigger').live('change', function() {

		var splitted_val = $(this).val().split('-');

		var sign = '';
		if(splitted_val[0]) {
			sign = splitted_val[0];
		}

		var sub_label_1 = '';
		if(splitted_val[1]) {
			sub_label_1 = splitted_val[1];
		}

		if(sign != '') {
			$(this).parents('.single-field').find('.currency-format').html(sign);
		}

		if(sub_label_1 != '') {
			$(this).parents('.single-field').find('.amount-sub-label').html(sub_label_1);
			$(this).parents('.single-field').find('.amount_sub_label_trigger').val(sub_label_1);
		}

	});

	//SUBMIT-INPUT-TRIGGER

	$('.submit-text-trigger').live('keyup', function(){

		$('.submitBtn').val($(this).val());
	});

	//SHOW HIDE RESET BUTTON

	$('#reset_button_flag').live('change', function() {

		var $instance = $(this).parents('.single-field').find('.resetBtn');
	
		if($instance.hasClass('hide-reset')){
		
			$instance.removeClass('hide-reset').addClass('show-reset');
		
		}else if($instance.hasClass('show-reset')){
		
			$instance.removeClass('show-reset').addClass('hide-reset');
		}
	});

	//RESET BUTTON TRIGGER

	$('#reset_text').live('keyup', function(){
	
		$('.resetBtn').val($(this).val());
	});

	//SHOW HIDE PRINT BUTTON

	$('#print_button_flag').live('change', function(){

		var $instance = $(this).parents('.single-field').find('.printBtn');
	
		if($instance.hasClass('hide-print')){
		
			$instance.removeClass('hide-print').addClass('show-print');
		
		}else if($instance.hasClass('show-print')){
		
			$instance.removeClass('show-print').addClass('hide-print');
		}
	});

	//RESET BUTTON TRIGGER

	$('#print_button_text').live('keyup', function(){
	
		$('.printBtn').val($(this).val());
	});


	//TOOL TIP POSITION

	$('.tool_tip_position_trigger').live('change', function(){

		var $instance = $(this).parents('.single-field').find('.tip-below-field');

		if($(this).val() == 1){
		   $instance.fadeIn('fast');
		}else{
		   $instance.fadeOut('fast');		
		}
	});

	//TOOL TIP TEXT POSITION

	$('.tool_tip_text_trigger').live('keyup', function(){

		var $instance = $(this).parents('.single-field').find('.tip-below-field');
		var value = $(this).val();
		$instance.html(value);
	});


	//IMAGE ALIGNMENT

	$('.image_alignment_trigger').live('change', function(){

		var alignment = $(this).val();
		$(this).parents('.single-field').find('.image-wrapper td').attr('align', alignment);
	});


	//IMAGE WIDTH

	$('.image_width_trigger').live('keyup', function(){
	
		var width		 =	 $(this).val();
		var $image		 =	 $(this).parents('.single-field').find('.image-wrapper img');
		$image.attr('width', width);
	});

	//IMAGE HEIGHT

	$('.image_height_trigger').live('keyup', function(){
	
		var height		 =	 $(this).val();
		var $image		 =	 $(this).parents('.single-field').find('.image-wrapper img');
		$image.attr('height', height);
	});

/*-------------------Live edit Code end------------------------*/

	$('.titleTxt').live('click', function(){
	
		$(this).siblings('.previewContainerMid').slideToggle('medium');
	});

	$('#form_list').change(function() {

		var fid = $('#form_list option:selected').val();
		var actionN = base_path+'form/editform/'+fid;
		$('#form_entries').attr('action', actionN);
		$('#form_entries').submit();
	});

	$('#publish_list').change(function() {

		var fid = $('#publish_list option:selected').val();
		var actionN = base_path+'publish/options/'+fid;
		$('#form_entries').attr('action', actionN);
		$('#form_entries').submit();
	});

	$('#styling_list').change(function() {

		var fid = $('#styling_list option:selected').val();
		var actionN = base_path+'form/styling/'+fid;
		$('#form_entries').attr('action', actionN);
		$('#form_entries').submit();
	});

/*------------------ Zoom Form Code ---------------------------*/

	$('#zoom-form').click(function() {
		
		if($(this).hasClass('not-zoomed')) {

			$('#zoom_btn').attr('title', '');
			$('#zoom_btn').attr('title', 'Go normal screen');

			$('#header').css('padding', '0px');

			$('.titleBar').hide();

			$('.topMenu').css('width','auto');
			$('#header').css('width','auto');
			$('.topSubMenu').css('width','auto');
			$('#body').css('width','auto');

			$('.rtContainer').css('width', '81.5%').css('margin-top', '0');
			$('.midContent').css('width', 'auto');
			$('.mainTitleTop').css('width', 'auto');
			$('.btmContent').css('width', 'auto');
			$('.demo').css('margin', '0 0 0 20px');

			$(this).removeClass('not-zoomed').addClass('zoomed');

			//resize the overlay and modal

			$('#form-overlay').height($('.midContent').outerHeight()).width($('.midContent').width());
			var container_width = $('.midContent').width();
			var form_settings_div = $('#form-settings-div').width();
			var left_pos = (container_width-form_settings_div)/2;
			$('#form-settings-div').css('left', left_pos+'px');

			$('#footer').hide();

		}else {

			$('#zoom_btn').attr('title', '');
			$('#zoom_btn').attr('title', 'Go full screen');
		
			$('#header').css('padding', '');

			$('.topMenu').show();
			$('.titleBar').show();

			$('#header').css('width','1003px');
			$('.topSubMenu').css('width','970px');
			$('#body').css('width','973px');

			$('.rtContainer').css('width', '727px').css('margin-top', '0px');
			$('.midContent').css('width', '725px');
			$('.mainTitleTop').css('width', '718px');
			$('.btmContent').css('width', '725px');
			$('.demo').css('margin', '0px');

			$(this).removeClass('zoomed').addClass('not-zoomed');

			$('#form-overlay').height($('.midContent').outerHeight()).width($('.midContent').width());
			var container_width = $('.midContent').width();
			var form_settings_div = $('#form-settings-div').width();
			var left_pos = (container_width-form_settings_div)/2;
			$('#form-settings-div').css('left', left_pos+'px');

			$('#footer').show();
		}
	});

//PUBLISH OPTIONS
	$('.option-trigger').click(function() {

		 var $click_instance = $(this);
		
		 var type = $(this).attr('id').split('_')[0];

		 if(type == 'link') {
			$('.inside_box_desc').html("Use the code snippet provided here to create a direct link to your Form2pay form on our servers. These are the links you'll want to use to share with others in your emails, instant messages and web pages");
		 }else if(type == 'ssl') {
			$('.inside_box_desc').html('Provide a direct link of your secured form by using this option');
		 }else if(type == 'html') {
			$('.inside_box_desc').html('Copy & paste it on your webpage to display the form.');
		 }else if(type == 'clean') {
			$('.inside_box_desc').html('Want to manually style your form, use this code to get a clean HTML layout of your form.');
		 }else if(type == 'script') {
			$('.inside_box_desc').html('Copy & paste this script on your webpage to display the form.');
		 }else if(type == 'fb') {
			$('.inside_box_desc').html('Copy and paste the code to your Static Html Iframe Tab page on your Facebook page: (visit our <a href="'+base_path+'guides/fb_user_guide" style="background:none;color:#1C24C9;border:none;width:65px;" target="_blank">user guide </a> for more information)');
		 }else if(type == 'wp') {
			$('.inside_box_desc').html('Copy and paste the Shortcode to your WordPress page where you want to publish the form with our <a href="http://wordpress.org/plugins/form2pay/" style="background:none;color:#1C24C9;border:none;width:65px;" target="_blank">plugin </a>)');
		 }else if(type == 'QR') {
			$('.inside_box_desc').html('Download and display it on your webpage, to read/scan it and access the direct link of your form');
		 }

		 $('.option-tabs').each(function() {
		 
			var id = $(this).attr('id').split('-')[1];

			if(type == id) {
			
				$(this).removeClass('hide').addClass('show');
			}else {
			
				$(this).removeClass('show').addClass('hide');	
			}
		 });

		 $('.publish-links li').each(function() {
		 
			$(this).removeClass('activeTab');
		 });

		$click_instance.parents('li').addClass('activeTab');
	});


	$('#back-to-notification-settings').live('click', function() {

		var form_id = '{$form_id}';
		var warning_messages_form = $('#warning_messages_form').serialize();
		var url = base_path+'form/save_warning_messages/'+form_id;

		$('.main-loader').slideDown("slow");
		
		$.post(url, { warning_messages_form : warning_messages_form }, function(data) {

			$('.main-loader').slideUp("slow");

			if(data == 'affected') {
				window.location.hash = '#show-notification-settings';
			}
		});
	});

	//AUTORESPONDER settings save
	$('.save-autoresponder-settings').live('click', function() 
	{
		var form_settings_autoresponder_from	= '';
		var form_settings_autoresponder_subject = '';

		if($('#form-settings-autoresponder-check').is(':checked')) {

			var from = $('#form-settings-autoresponder-from').val();

			if(from == '') {
				$('.error-line').html('').fadeOut('fast');
				$('.error-line').html('Please enter from email-id').fadeIn('fast');
				$('#form-settings-autoresponder-from').css('border', '1px solid red');
				$('#form-settings-autoresponder-from').focus();
				return false;
			}else {

				var pattern	= /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/;
				var result	= pattern.test(from);
	
				if(!result) {
					$('.error-line').html('').fadeOut('fast');
					$('.error-line').html('Please enter valid email').fadeIn('fast');
					$('#form-settings-autoresponder-from').css('border', '1px solid red');
					$('#form-settings-autoresponder-from').focus();
					return false;
				}else{
					form_settings_autoresponder_from = from;
				}
			}

			var subject	= $('#form-settings-autoresponder-subject').val();

			if(subject == '')
			{
				$('.error-line').html('').fadeOut('fast');
				$('.error-line-2').html('Please enter subject').fadeIn('fast');
				$('#form-settings-autoresponder-from').css('border', '');
				$('#form-settings-autoresponder-subject').css('border', '1px solid red');
				$('#form-settings-autoresponder-subject').focus();
				return false;
			}else {
				form_settings_autoresponder_subject	= subject;
			}
		}

		var id = $(this).attr('id');

		var form_settings_autoresponder_check		=		$('#form-settings-autoresponder-check').is(':checked') ? 'yes' : 'no';
		var user_email_address						=		$('#user_email_address').val();
		var form_settings_autoresponder_name		=		$('#form-settings-autoresponder-name').val();
		var form_settings_autoresponder_msg			=		$('#form-settings-autoresponder-msg').val();
		var form_id									=		$('#form_id').val();

		var url = base_path+'form/save_autoresponder_settings/';

		$('.main-loader').slideDown("slow");

		$('#tool-save').click();
		$('#'+id).find('a').html('Saving...');

		$.post(
			url, 
			{ form_id : form_id, 
			form_settings_autoresponder_check	: form_settings_autoresponder_check, 
			user_email_address					: user_email_address, 
			form_settings_autoresponder_name	: form_settings_autoresponder_name,
			form_settings_autoresponder_from	: form_settings_autoresponder_from, 
			form_settings_autoresponder_subject : form_settings_autoresponder_subject, 
			form_settings_autoresponder_msg		: form_settings_autoresponder_msg },
			function(data) {

			$('#'+id).find('a').html('Saved');				

			if(id == 'save-autoresponder-settings-next') {

				window.location.hash = '#show-success-page-settings';
				return false;
//				window.location.hash = '#show-payment-settings';

			}else if(id == 'save-autoresponder-settings-back') {

				window.location.hash = '#show-sms-notification-settings';

			}else if(id == 'auto_responder_test_mail') {

				var auto_url = base_path+'form/fire_auto_responder_test_mail';

				$('.main-loader').slideDown("slow");

				$.post(auto_url, { form_id : form_id }, function(data) {

					$('.main-loader').slideUp("slow");

					if(data == 'sent') {

						$('#test_mail_hidden_td').fadeIn(function() {

							$('#mail_failure').hide();
							$('#mail_success').html('Mail has been sent to email address - '+form_settings_autoresponder_from).show();
						});
					}else {

						$('#test_mail_hidden_td').fadeIn(function() {

							$('#mail_success').hide();
							$('#mail_failure').html('Something went wrong please contact support@form2pay.com !').show();
						});
					}
				});

			}else {
				$('#form-overlay').click();
			}
		});
	});

	//PAYMENT GATEWAY settings save
	$('.save-payment-settings').live('click', function() 
	{
		var id = $(this).attr('id');

		var form_settings_payment_check			=	$('#form-settings-payment-check').is(':checked') ? 'yes' : 'no';

		var merchant_type						=	$('#merchant_type').val();

		var payment_paypal_email				=	$('#payment_paypal_email').val();
		var payment_paypal_language				=	$('#payment_paypal_language').val();
		var payment_paypal_currency				=	$('#payment_paypal_currency').val();

		var payment_two_co_number				=	$('#payment_two_co_number').val();
		var payment_two_co_currency				=	$('#payment_two_co_currency').val();
		var payment_two_co_language				=	$('#payment_two_co_language').val();

		var payment_paypal_pro_username			=	$('#payment_paypal_pro_username').val();
		var payment_paypal_pro_password			=	$('#payment_paypal_pro_password').val();
		var payment_paypal_pro_signature		=	$('#payment_paypal_pro_signature').val();
		var payment_paypal_pro_currency			=	$('#payment_paypal_pro_currency').val();

		var payment_authorize_login_id			=	$('#payment_authorize_login_id').val();
		var payment_authorize_transaction_key	=	$('#payment_authorize_transaction_key').val();
		var	payment_authorize_currency			=	$('#payment_authorize_currency').val();

		var sandbox_mode						=	$('#sandbox_mode').is(':checked') ? 'yes' : 'no';

		var pre_determined_amount_label			=	$('#pre_determined_amount_label').val();
		var pre_determined_amount				=	$('#pre_determined_amount').val();

		var custom_amount_check					=	$('#custom_amount_check').is(':checked') ? 'yes' : 'no';
//		var custom_amount_field_unique_value	=	$('#custom_amount_check').attr('rel');

/*
		var form_settings_amount_fields_2_check	=	$('#form-settings-amount-fields-2-check').is(':checked') ? 'yes' : 'no';

		var payment_fields_values = [];
		$('#form-settings-amount-fields-checkbox').find('input').each(function() {
			if($(this).is(':checked')){
				payment_fields_values.push($(this).attr('id'));
			}
		});
*/

		var custom_amount_field_unique_value = [];
		$('#custom_amount_field_checkbox').find('input').each(function() {
			if($(this).is(':checked')) {
				custom_amount_field_unique_value.push($(this).attr('rel'));
			}
		});

		var form_settings_other_payment_fields_all_check =	$('#form_settings_other_payment_fields_all_check').is(':checked') ? 'yes' : 'no';

		var other_payment_fields_values = [];
		$('#other_payment_fields_all_check_div ul li .form_settings_other_amount_form_field_checkbox').each(function() {
			if($(this).is(':checked')){
				other_payment_fields_values.push($(this).attr('id'));
			}
		});

		var other_payment_fields_option_values = [];
		$('.option_values').each(function() {
			obj = {};
			var this_field_unique_id = $(this).attr('id');
			var this_field_option_id = $(this).attr('rel');
			var this_fields_value	 = $(this).val();

			obj[this_field_unique_id] = this_fields_value;
			other_payment_fields_option_values.push(obj); 
		});

		var show_running_total			=	$('#show_running_total').is(':checked')			? 'yes' : 'no';
		var collect_shipping_address	=	$('#collect_shipping_address').is(':checked')	? 'yes' : 'no';
		var recurring_billing			=	$('#recurring_billing').is(':checked')			? 'yes' : 'no';
		
		var recurring_period		= '';
		var recurring_period_type	= '';
		if(recurring_billing == 'yes') {
			recurring_period			=	$('#recurring_period').val();
			recurring_period_type		=	$('#recurring_period_type').val();
		}

		var form_id	=  $('#form_id').val();

		var url = base_path+'form/save_payment_settings/';

		$('.main-loader').slideDown("slow");

		$('#tool-save').click();

		$('#'+id).find('a').html('Saving...');

		$.post(url, 
			{form_id : form_id, 
			form_settings_payment_check						: form_settings_payment_check, 
			form_settings_other_payment_fields_all_check	: form_settings_other_payment_fields_all_check, 
			other_payment_fields_values						: other_payment_fields_values, 
			other_payment_fields_option_values				: other_payment_fields_option_values, 
			merchant_type									: merchant_type, 
			payment_paypal_email							: payment_paypal_email, 
			payment_paypal_language							: payment_paypal_language, 
			payment_paypal_currency							: payment_paypal_currency,
			payment_two_co_number							: payment_two_co_number,
			payment_two_co_currency							: payment_two_co_currency,
			payment_two_co_language							: payment_two_co_language,
			payment_paypal_pro_username						: payment_paypal_pro_username,
			payment_paypal_pro_password						: payment_paypal_pro_password,
			payment_paypal_pro_signature					: payment_paypal_pro_signature,
			payment_paypal_pro_currency						: payment_paypal_pro_currency,
			payment_authorize_login_id						: payment_authorize_login_id,
			payment_authorize_transaction_key				: payment_authorize_transaction_key,
			payment_authorize_currency						: payment_authorize_currency,
			sandbox_mode									: sandbox_mode,
			pre_determined_amount_label						: pre_determined_amount_label,
			pre_determined_amount							: pre_determined_amount,
			custom_amount_check								: custom_amount_check,
			custom_amount_field_unique_value				: custom_amount_field_unique_value,
//			form_settings_amount_fields_2_check				: form_settings_amount_fields_2_check,
//			payment_fields_values							: payment_fields_values,
			show_running_total								: show_running_total,
			collect_shipping_address						: collect_shipping_address,
			recurring_billing								: recurring_billing,
			recurring_period								: recurring_period,
			recurring_period_type							: recurring_period_type
			},
			function(data) {

			$('#'+id).find('a').html('Saved');

			$('.main-loader').slideUp("slow");

			if(id == 'save-payment-settings-next') {

				window.location = base_path+'form/styling/'+form_id
				return false;
//				window.location.hash = '#show-success-page-settings';

			}else if(id == 'save-payment-settings-back') {

				window.location = base_path+'form/editform/'+form_id
				return false;

//				window.location.hash = '#show-auto-responder-settings';
			}
		});
	});

	function save_payment_settings() {
	
		var form_settings_payment_check			=	$('#form-settings-payment-check').is(':checked') ? 'yes' : 'no';

		var merchant_type						=	$('#merchant_type').val();

		var payment_paypal_email				=	$('#payment_paypal_email').val();
		var payment_paypal_language				=	$('#payment_paypal_language').val();
		var payment_paypal_currency				=	$('#payment_paypal_currency').val();

		var payment_two_co_number				=	$('#payment_two_co_number').val();
		var payment_two_co_currency				=	$('#payment_two_co_currency').val();
		var payment_two_co_language				=	$('#payment_two_co_language').val();

		var payment_paypal_pro_username			=	$('#payment_paypal_pro_username').val();
		var payment_paypal_pro_password			=	$('#payment_paypal_pro_password').val();
		var payment_paypal_pro_signature		=	$('#payment_paypal_pro_signature').val();
		var payment_paypal_pro_currency			=	$('#payment_paypal_pro_currency').val();

		var payment_authorize_login_id			=	$('#payment_authorize_login_id').val();
		var payment_authorize_transaction_key	=	$('#payment_authorize_transaction_key').val();
		var	payment_authorize_currency			=	$('#payment_authorize_currency').val();

		var sandbox_mode						=	$('#sandbox_mode').is(':checked') ? 'yes' : 'no';

		var pre_determined_amount_label			=	$('#pre_determined_amount_label').val();
		var pre_determined_amount				=	$('#pre_determined_amount').val();

		var custom_amount_check					=	$('#custom_amount_check').is(':checked') ? 'yes' : 'no';
//		var custom_amount_field_unique_value	=	$('#custom_amount_check').attr('rel');

		var form_settings_other_payment_fields_all_check =	$('#form_settings_other_payment_fields_all_check').is(':checked') ? 'yes' : 'no';

		var custom_amount_field_unique_value = [];
		$('#custom_amount_field_checkbox').find('input').each(function() {
			if($(this).is(':checked')) {
				custom_amount_field_unique_value.push($(this).attr('rel'));
			}
		});

		var other_payment_fields_values = [];
		$('#other_payment_fields_all_check_div ul li .form_settings_other_amount_form_field_checkbox').each(function() {
			if($(this).is(':checked')){
				other_payment_fields_values.push($(this).attr('id'));
			}
		});

		var other_payment_fields_option_values = [];
		$('.option_values').each(function() {
			obj = {};
			var this_field_unique_id = $(this).attr('id');
			var this_field_option_id = $(this).attr('rel');
			var this_fields_value	 = $(this).val();

			obj[this_field_unique_id] = this_fields_value;
			other_payment_fields_option_values.push(obj); 
		});

		var show_running_total			=	$('#show_running_total').is(':checked')			? 'yes' : 'no';
		var collect_shipping_address	=	$('#collect_shipping_address').is(':checked')	? 'yes' : 'no';
		var recurring_billing			=	$('#recurring_billing').is(':checked')			? 'yes' : 'no';
		
		var recurring_period			= '';
		var recurring_period_type		= '';

		if(recurring_billing == 'yes') {
			recurring_period			=	$('#recurring_period').val();
			recurring_period_type		=	$('#recurring_period_type').val();
		}

		var form_id	=  $('#form_id').val();

		var url = base_path+'form/save_payment_settings/';

		$('.main-loader').slideDown("slow");

		$('#tool-save').click();

		$.post(url, 
			{form_id : form_id, 
			form_settings_payment_check						: form_settings_payment_check, 
			form_settings_other_payment_fields_all_check	: form_settings_other_payment_fields_all_check, 
			other_payment_fields_values						: other_payment_fields_values, 
			other_payment_fields_option_values				: other_payment_fields_option_values, 
			merchant_type									: merchant_type, 
			payment_paypal_email							: payment_paypal_email, 
			payment_paypal_language							: payment_paypal_language, 
			payment_paypal_currency							: payment_paypal_currency,
			payment_two_co_number							: payment_two_co_number,
			payment_two_co_currency							: payment_two_co_currency,
			payment_two_co_language							: payment_two_co_language,
			payment_paypal_pro_username						: payment_paypal_pro_username,
			payment_paypal_pro_password						: payment_paypal_pro_password,
			payment_paypal_pro_signature					: payment_paypal_pro_signature,
			payment_paypal_pro_currency						: payment_paypal_pro_currency,
			payment_authorize_login_id						: payment_authorize_login_id,
			payment_authorize_transaction_key				: payment_authorize_transaction_key,
			payment_authorize_currency						: payment_authorize_currency,
			sandbox_mode									: sandbox_mode,
			pre_determined_amount_label						: pre_determined_amount_label,
			pre_determined_amount							: pre_determined_amount,
			custom_amount_check								: custom_amount_check,
			custom_amount_field_unique_value				: custom_amount_field_unique_value,
//			form_settings_amount_fields_2_check				: form_settings_amount_fields_2_check,
//			payment_fields_values							: payment_fields_values,
			show_running_total								: show_running_total,
			collect_shipping_address						: collect_shipping_address,
			recurring_billing								: recurring_billing,
			recurring_period								: recurring_period,
			recurring_period_type							: recurring_period_type
			},
			function(data) {

				$('.main-loader').slideUp("slow");
		});
	}

	$('.helpIco').live('click', function(e) {

		e.preventDefault();
		var $clicked = $(this);
		var tag	=	$(this).attr('rel');
		var url = base_path + 'form/help_dropdown';
	
		$.ajax({
			type	 : 'POST',
			url		 : url,
			data	 : ({return_type: 'json_array', tag: tag}),
			dataType : "json",
			success  : function(data) {

				var img = base_path+'files/field_preview/'+data.field_preview;

				$('#field-ajax-name').html(data.name);
				$('#field-ajax-image').attr('src', img);
				$('#field-ajax-description').html(data.description);

				var temp_edited_template = $('#field-ajax-container').html();

				$('.help_dropdown').each(function(){
					$(this).html('').css('display', 'none');
				});

				if($('div.properties-table').hasClass('help_dropdown_down')) {

					$('div.properties-table').removeClass('help_dropdown_down').addClass('help_dropdown_up');

					$clicked.parents('div.properties-table').find('.help_dropdown').html(temp_edited_template).slideUp('fast');
				}else {

					$('div.properties-table').removeClass('help_dropdown_up').addClass('help_dropdown_down');
	
					$clicked.parents('div.properties-table').find('.help_dropdown').html(temp_edited_template).slideDown('fast');
				}
			}
		});
	});